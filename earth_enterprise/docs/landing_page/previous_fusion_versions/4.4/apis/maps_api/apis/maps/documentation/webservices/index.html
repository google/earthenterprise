<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">














  

  


<html>
  <head>
    <script type="text/javascript" language="JavaScript">
    ORIGINAL_PAGE_PATH = "/apis/maps/documentation/webservices/index.html";
    </script>
    
    
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Google Maps API Web Services - Google Maps API Web Services - Google Code</title>
<script type="text/javascript"><!--
(function(){function a(){this.t={};this.tick=function(c){this.t[c]=(new Date).getTime()};this.tick("start")}var b=new a;window.jstiming={Timer:a,load:b};if(window.external&&window.external.pageT)window.jstiming.pt=window.external.pageT;})();

var _tocPath_ = '/apis/maps/documentation/webservices/_toc.ezt';
var codesite_token = null;
var logged_in_user_email = null;
//--></script>
<link href="../../../../css/codesite.pack.04102009.css" type="text/css" rel="stylesheet">
<script src="../../../../js/codesite_head.pack.04102009.js" type="text/javascript"></script>
<script type="text/javascript">CODESITE_CSITimer['load'].tick('bhs');</script>
<link rel="search" type="application/opensearchdescription+xml" title="Google Code" href="http://code.google.com/osd.xml">

<!--[if IE]><link rel="stylesheet" type="text/css" href="../../../../css/iehacks.css"><![endif]-->

<script type="text/javascript">
function toggle(id,iconid)
{
 var element = document.getElementById(id);
 var icon = document.getElementById(iconid);
 if (element.style.display == "none") {
   element.style.display = "block";
   icon.src = "/apis/maps/documentation/images/minus.png";
 } else {
   element.style.display = "none";
   icon.src = "/apis/maps/documentation/images/plus.png";
 }
}
</script>
  </head>

  <body class="gc-documentation">

    <div id="gb">
 <span>
  
    <a id="lang-dropdown" href="http://code.google.com" onclick="return false;"><span style="text-decoration:underline">English</span> <span style="font-size:.75em;">&#9660;</span></a>
  
 </span>
</div>

<div class="gbh" style="left:0px;"></div>
<div class="gbh" style="right:0px;"></div>

<div id="gc-container">
<a id="top"></a>
<div id="skipto">
  
  
</div>

<div id="gc-header">
  <div id="logo"><a href="http://code.google.com">
  
  
     <img src="../images/code_logo.gif" height="40" width="167" alt="Google Code" style="border:0;margin:3px 0 0 0;">
  
  
  </a></div>
  <div id="search">
    <div id="searchForm" class="searchForm">
      <form id="cse" action="http://www.google.com/cse" accept-charset="utf-8" class="gsc-search-box" onsubmit="executeGSearch(document.getElementById('gsearchInput').value); return false;">
      <noscript>
      <input type="hidden" name="cref" value="http://code.google.com/cse/googlecode-context.xml">
      </noscript>
      <div id="gsc-search-box">
        <input id="gsearchInput" type="text" name="q" maxlength="2048" class="gsc-input" autocomplete="off" title="Google Code Search" style="width:345px">
        <div id="cs-searchresults" onclick="event.cancelBubble = true;"></div>
        <input title="Search" id="gsearchButton" class="gsc-search-button" name="sa" value="Search" type="submit">
        <div class="greytext">e.g. "adwords" or "open source"</div>
      </div>
      </form>
    </div> <!-- end searchForm -->
  </div> <!-- end search -->




</div> <!-- end gc-header -->


<div id="codesiteContent">

<a id="gc-topnav-anchor"></a>
<div id="gc-topnav">
  <h1 style="padding:0 0 0 6px;">Google Maps API Web Services</h1>
  <ul id="docs" class="gc-topnav-tabs">

    <li id="home_link">
      <a href="index.html" title="Google Maps API Web Services home page">Home</a>
    </li>
  
    <li id="docs_link">
      <a href="index.html" class="selected" title="Official Google Maps API Web Services documentation">Docs</a>
    </li>
  
    <li id="faq_link">
      <a href="../../faq.html" title="Answers to frequently asked questions about Google Maps API Web Services">FAQ</a>
    </li>
  
    <li>
      <a href="http://googlegeodevelopers.blogspot.com/" title="Official Google Maps API Web Services blog">Blog</a>
    </li>
  
    <li>
      <a href="forum.html" title="Google Maps API Web Services developer forum">Forum</a>
    </li>
  
    <li>
      <a href="../../terms.html" title="Google Maps API Web Services terms of service">Terms</a>
    </li>
  

  </ul>
</div> <!-- end gc-topnav -->

    <div class="g-section g-tpl-170">

      <a name="gc-toc-anchor"></a>  
      <div class="g-unit g-first" id="gc-toc">
        <ul>
  <li><a href="../../index.html">Maps API Family</a></li>
  <li><a href="http://code.google.com/apis/kml/documentation/kmlSearch.html">Index Your Maps Content</a></li>
</ul>
    <div class="line"></div>
      <ul>
        <li><h2><a href="index.html">Maps API Web Services</a></h2>
         <ul>
           <li><a href="../geocoding/index.html">Geocoding API</a></li>
           <li><a href="../directions/index.html">Directions API</a></li>
           <li><a href="../elevation/index.html">Elevation API</a></li>
           <li><a href="../places/index.html">Places API</a></li>
         </ul>
       </li>
      </ul>
<div class="line"></div>
<ul>
  <li><h2>Maps JavaScript API V3</h2>
    <ul>
      <li><a href="../javascript/index.html">Home Page</a></li>
      <li><a href="../javascript/basics.html">Documentation</a></li>
    </ul>
  </li>
</ul>
      <ul>
        <li><h2>Maps Javascript API V2</h2>
         <p><span style="color:grey">(Deprecated API)</span></p>
         <ul>
           <li><a href="../javascript/v2/index.html">Home Page</a></li>
           <li><a href="../javascript/v2/basics.html">Documentation</a></li>
         </ul>
       </li>
      </ul>
<div class="line"></div>
<ul>
  <li><h2>Maps API for Flash</h2>
    <ul>
      <li><a href="../flash/index.html">Home Page</a></li>
      <li><a href="../flash/intro.html">Documentation</a></li>
    </ul>
  </li>
</ul>
   <div class="line"></div>
    <ul>
      <li><h2>Maps Data API</h2>
        <p><span style="color:grey">(Deprecated API)</span></p>
        <ul>
          <li><a href="../mapsdata/index.html">Home Page</a></li>
          <li><a href="../mapsdata/developers_guide_protocol.html">Documentation</a></li>
        </ul>
      </li>
    </ul>
       <div class="line"></div>
        <ul>
          <li><h2>Static Maps API</h2>
            <ul>
              <li><a href="../staticmaps/index.html">Developer Guide</a></li>
            </ul>
          </li>
        </ul>
<div class="line"></div>
        <ul>
          <li><h2>Earth API</h2>
            <ul>
              <li><a href="http://code.google.com/apis/earth">Home Page</a></li>
              <li><a href="http://code.google.com/apis/earth/documentation">Documentation</a></li>
            </ul>
          </li>
        </ul>
      <div class="line"></div>
        <ul>
          <li><h2>Local Search API</h2>
            <p><span style="color:grey">(Deprecated API)</span></p>
            <ul>
              <li>
                <a href="../localsearch/index.html">Home Page</a>
              </li>
              <li>
                <a href="../localsearch/start.html">Documentation</a>
              </li>
            </ul>
          </li>
        </ul>
   <div class="line"></div>
<div class="promo">
<p><a href="../premier/index.html">Google Maps API Premier</a></p>
<p>Includes enterprise licensing and support</p>
</div>

      </div>
      
      <a name="gc-pagecontent-anchor"></a>   
      <div class="g-unit" id="gc-pagecontent">
        <h1 class="page_title">Google Maps API Web Services</h1>


<p>This document discusses the Maps API Web Services, a collection of HTTP
interfaces to Google services providing geographic data for your
maps applications. This guide serves only to introduce the web services
and host information common to all of the different services. Individual
documentation for each service is located below:</p>

<ul>
  <li><a href="../geocoding/index.html">Geocoding API</a></li>
  <li><a href="../directions/index.html">Directions API</a></li>
  <li><a href="../elevation/index.html">Elevation API</a></li>
  <li><a href="../places/index.html">Places API</a></li>
</ul>

<p>The remainder of this guide discusses techniques for setting up
web service requests and parsing the responses. For particular
documentation for each service, however, you must consult the
appropriate documentation.</p>

<h1 id="Services">Table of Contents</h1>

<div class="toc">
  <ol>
  <li><a href="#WebServices">What is a Web Service?</a></li>
  <li><a href="#ClientIDs">Specifying a <i>Client ID</i></a></li>
  <li><a href="#Sensor">Tracking Usage with the <code>sensor</code> Parameter</a></li>
  <li><a href="#BuildingURLs">Building Valid URLs</a></li>
  <li><a href="#URLSigning">URL Authentication</a>
 <ol>
     <li><a href="#SignatureProcess">The URL Signing Process</a>
       <ol>
         <li><a href="#GettingKeys">How Do I Get My Private Key?</a></li>
         <li><a href="#GeneratingSignatures">Generating Valid Signatures<a></li>      
       </ol>
     </li>
     <li><a href="#SignatureExamples">Signature Examples</a>
       <ol>
         <li><a href="#PythonSignatureExample">Example: Signing a URL in Python</a></li>
         <li><a href="#JavaSignatureExample">Example: Signing a URL in Java</a></li>
         <li><a href="#CSharpSignatureExample">Example: Signing a URL in C#</a></li>
         <li><a href="#MoreSignatureExamples">Signing URLs: Examples in
         Additional Languages</a></li>
       </ol>
     </li>
   </ol>
 </li>
  <li><a href="#Parsing">Processing Responses</a>
    <ol>
      <li><a href="#ParsingXML">Processing XML with XPath</a></li>
      <li><a href="#ParsingJSON">Processing JSON with Javascript</a></li>    
    </ol>
  </ol>
</div>

<h1 id="WebServices">What is a Web Service?</h1>

<p>The Google Maps API provides these web services as an interface
for requesting Maps API data from external services and using them
within your Maps applications. These services are designed to be
used in conjunction with a map, as per the
<a href="../../terms.html#section_10_12">Maps API Terms of
Service License Restrictions</a>.</p>

<p>These web services use HTTP requests to specific URLs,
passing URL parameters as arguments to the services. Generally,
these services return data in the HTTP request as either
JSON or XML for parsing and/or processing by your application.</p>

<p>A typical Web Service request is generally of the following form:</p>

<pre>
http://maps.googleapis.com/maps/api/<i>service</i>/<i>output</i>?<i>parameters</i>
</pre>

<p>where <code>service</code> indicates the particular service requested and
<code>output</code> indicates the response format (usually <code>json</code>
or <code>xml</code>.</p>

<p>Full documentation of each service is contained within the
particular developer guides for those services. However, this
guide serves to hold some common practices useful for setting
up your web service requests and processing your web service
responses.</p>

<h1 id="ClientIDs">Specifying a <i>Client ID</i></h1>

<p>To access the Place web service, you must satisfy the
<a href="../places/index.html#Requirements"><i>application
requirements </i></a> and apply for this service. Registration for the
service is free; once registered, Google will send you a <i>client ID</i>,
which you will provide to the service as an additional parameter to
identify you.</p>

<p>Note: at this time, only the Place web service requires a client ID.</p>

<h1 id="Sensor">Tracking Usage with the <code>sensor</code> Parameter</h1>

<p>Use of the Google Maps API(s) now requires that you indicate whether your
application is using a sensor (such as a GPS locator) to determine the user's
location in any Maps API library or service requests. This is especially
important for mobile devices. If your Google Maps API application 
uses any form of sensor to determine the location of the device accessing your 
application, you must declare this with a <code>sensor</code> parameter value 
of <code>true</code>.</p>

<p>Note that even if your application does not use a location sensor, you
still must set the <code>sensor</code> parameter (in this case to <code>false</code>).</p>

<h1 id="BuildingURLs">Building a Valid URL</h1>

<p>You may think that a "valid" URL is self-evident, but
that's not quite the case. A URL entered within an address bar in a
browser, for example, may contain special characters (e.g.
<code>"上海+中國"</code>); the browser needs to internally translate
those characters into a different encoding before transmission.
By the same token, any code that generates or accepts UTF-8 input
might treat URLs with UTF-8 characters as "valid", but would also need
to translate those characters before sending them out to a web server.
This process is called <a href="http://en.wikipedia.org/wiki/URL_encoding">
URL-encoding</a>.</p>

<p>We need to translate special characters because
all URLs need to conform to the syntax specified by the
<a href="http://tools.ietf.org/html/rfc3986">W3 Uniform
Resource Identifier</a> specification. In effect, this means that URLs
must contain only a special subset of ASCII characters: the familiar
alphanumeric symbols, and some reserved characters for use as control
characters within URLs. The table below summarizes these characters:</p>

<table>
  <title>Summary of Valid URL Characters</title>
  <tr>
  <th>Set</th><th>characters</th><th>URL usage</th>
  </tr>
  <tr>
  <td>Alphanumeric</td>
  <td>a   b   c   d   e   f   g   h   i   j   k   l  m  
  n   o   p   q   r   s   t   u   v   w   x   y   z   
  A   B   C   D   E   F   G   H   I   J   K   L   M   
  N   O   P   Q   R   S   T   U   V   W   X   Y   Z
  0  1   2   3   4   5   6   7   8   9
  <td>Text strings, scheme usage (<code>http</code>), port (<code>8080</code>), etc.</td>
  </tr>
  <tr>
  <td>Unreserved</td>
  <td>- _ . ~</td>
  <td>Text strings</td>
  </tr>
  <tr>
  <td>Reserved</td>
  <td>! * ' ( ) ; : @ &amp; = + $ , / ? % # [ ]</td>
  <td>Control characters and/or Text Strings</td>
  </tr>
</td>
</table>

<p>When building a valid URL, you must ensure that it contains
only those characters shown above. Conforming a URL to use this
set of characters generally leads to two issues, one of omission
and one of substitution:</p>

<ul>
  <li>Characters that you wish to handle exist outside of the
  above set. For example, characters in foreign languages
  such as <code>上海+中國</code> need to be encoded using the
  above characters. By popular convention, spaces (which are
  not allowed within URLs) are often represented using the plus
  <code>'+'</code> character as well.</li>
  <li>Characters exist within the above set as reserved characters,
  but need to be used literally.
  For example, <code>?</code> is used within URLs to indicate
  the beginning of the query string; if you wish to use the
  string "? and the Mysterions," you'd need to encode the
  <code>'?'</code> character.</li></li>
</ul>

<p>All characters to be URL-encoded are encoded
using a <code>'%'</code> character and a two-character hex
value corresponding to their UTF-8 character. For example,
<code>上海+中國</code> in UTF-8 would be URL-encoded as
<code>%E4%B8%8A%E6%B5%B7%2B%E4%B8%AD%E5%9C%8B</code>. The
string <code>? and the Mysterians</code> would be URL-encoded as
<code>%3F+and+the+Mysterians</code>.</p>

<p>Converting a URL that you receive from user input is sometimes
tricky. For example, a user may enter an address as "5th&amp;Main St."
Generally, you should construct your URL from its parts, treating
any user input as literal characters.</p>

<p>Additionally, URLs are limited to 2048 characters for all web
services. For most services, this character limit will seldom be
approached. However, note that certain services have several
parameters that may result in long URLs.</p>

<h1 id="URLSigning">URL Authentication</h1>

<p>Requests to certain Maps API web services now require digital
<i>signatures</i> using a cryptographic key we provide to you for that purpose.
The signing process combines a URL and a private key together using an
encryption algorithm, creating a unique signature. This unique signature allows
our web services to verify that any site generating requests that use your Maps
API client ID are authorized to do so. The signature is also unique per
URL, ensuring that requests that use your client ID cannot be modified without
requiring a new signature to be generated.</p>

<p>URL signing serves both to authenticate you to our web services as well as
accurately track your usage. Currently, the following web services
requires URL signatures on all requests:</p>

<ul>
  <li>The <a href="../places/index.html">
  Places API</a></li>
</ul>

<p>The following web services require that all requests made by
<a href="../premier/index.html">Maps API Premier</a>
applications include URL signatures:</p>

<ul>
  <li>The <a href="../staticmaps/index.html">
  Static Maps API V2</a></li>
  <li>The new <a href="../geocoding/index.html">
  Geocoding API V3</a> <span style="color:red">Note: </span>
  users of the legacy <a href="../geocoding/v2/index.html">
  Geocoding API V2</a> are unaffected
  by this change.</li>
  <li>The <a href="../elevation/index.html">
  Elevation API</a></li>
</ul>

<p><span class="note">URL signing is not currently required when using any
other free Maps API web service, or any of the client APIs such as the JavaScript
Maps API, Maps API for Flash, or Earth API. If URL signing is extended to any
other existing Maps API web service, an announcement
will be made on the <a href="http://googlegeodevelopers.blogspot.com/">Google Geo
Developer's Blog</a>.</p>

<h2 id="SignatureProcess">The URL Signing Process</h2>

<p>Signing a URL involves generating a <i>signature</i> using a
private key shared between you and Google, which you attach to any HTTP
(or HTTPS) requests. See <a href="#GettingKeys">How Do I Get My
Private Key?</a> below. You generate this signature for a URL
using the private key, which creates a hash that is unique to that
URL and the private key. If the URL differs in any way from that
used to generate the signature, the service will reject the request
as invalid.</p>

<p><span style="color:red">Note: </span> attempting to access a web service
with an invalid signature will result in a <code>HTTP 403</code>
(Forbidden) error. As you convert your applications to use URL signing,
make sure to test your signatures to ensure they initiate a valid
request. You should first test whether the original URL is valid
(See <a href="#BuildingURLs">Building a Valid URL</a> above) as well
as test whether you generate the correct signatures (See
<a href="#GeneratingSignatures">Generating Valid Signatures</a>
below).</p>

<h3 id="GettingKeys">How Do I Get My Private Key?</h3>

<p>Your cryptographic URL-signing key will be issued with your
client ID. Client IDs are issued to all Maps API Premier customers,
and to developers who apply to use the Places web service.
This private key is unique to your client ID. For
that reason, please keep your key secure. This key &mdash; though used
to generate the signature &mdash; should <b>not</b> be passed within any
requests, stored on any websites, or posted to any public forum. Anyone
obtaining this key "in the clear" could spoof requests using
your identity.</p>

<p class="note">Note that this cryptographic key is not the same
as the (freely available) Maps API key. The Maps API key is
solely for identification purposes and is not used for authentication;
your URL-signing key serves to both identify and authenticate your
requests.</p>

<h3 id="GeneratingSignatures">Generating Valid Signatures</h3>

<p class="note">To aid debugging, make sure that
your URLs are already valid before you sign them! Doing so allows
you to focus on correcting invalid signatures if you discover errors
when signing your URLs. See <a href="#BuildingURLs">Building
Valid URLs</a> for more information.</p>

<p>The following steps outline the process you should use to sign
a valid URL:</p>

<ol>
  <li><p>Construct your URL, making sure to include your
  <code>client</code> and <code>sensor</code> parameters. Note
  that any non-standard characters will need to be URL-encoded:</p>
  <p>
  <pre class="prettyprint">
  http://maps.googleapis.com/maps/api/staticmap?center=%E4%B8%8A%E6%B5%B7+%E4%B8%AD%E5%9C%8B&amp;client=<i>clientID</i>&amp;sensor=<i>true_or_false</i>
  </pre>
  <p class="note">Note: all Google services require UTF-8 character
  encoding (which implicitly includes ASCII). Make sure that if your
  applications operate using other character sets, that they construct
  URLs using UTF-8 and properly URL-encode them beforehand.</p>
  </p>
  </li>
  <li><p>Strip off the domain portion of the request, leaving only
  the path and the query:</p>
  <pre class="prettyprint">
  /maps/api/staticmap?center=%E4%B8%8A%E6%B5%B7+%E4%B8%AD%E5%9C%8B&amp;client=<i>clientID</i>&amp;sensor=<i>true_or_false</i>
  </pre>
  </li>
  <li>
  <p>Retrieve your private key, which is encoded in
  a modified <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> for URLs
  <span style="color:red">*</span>,
  and sign the URL above using the HMAC-SHA1 algorithm. You may need to decode
  this key into its original binary format. Note that in most cryptographic
  libraries, the resulting signature will be in binary format.</p>
  </li>
  <li><p>Encode the resulting binary signature using the modified
  <a href="http://en.wikipedia.org/wiki/Base64">Base64</a> for URLs
  <span style="color:red">*</span> to convert this signature into something
  that can be passed within a URL.</p></li>
  <li><p>Attach this signature to the URL within a <code>signature</code>
  parameter:</p>
  <pre class="prettyprint">
  http://maps.googleapis.com/maps/api/staticmap?center=%E4%B8%8A%E6%B5%B7+%E4%B8%AD%E5%9C%8B&amp;client=<i>clientID</i>&amp;sensor=<i>true_or_false</i>&amp;signature=<i>base64signature</i></i>
  </pre>
  </li>
</ol>

<p><span style="color:red">* Note: </span> Modified Base64 for URLs replaces the
'<code>+</code>' and '<code>/</code>' characters of standard Base64 with
'<code>-</code>' and '<code>_</code>' respectively, so that these Base64
signatures no longer need to be URL-encoded.</p>

<h2 id="SignatureExamples">Signature Examples</h2>

<p>The following sections show ways to implement URL signing using
server-side code. For simplicity, many of these samples have
hard-coded URLs and private keys. URLs should always be signed server-side
to avoid exposing your cryptographic key to users.</p>

<p>For testing purposes, you can test the following URL and private key
to see if it generates the correct signature. Note that this private key
is purely for testing purposes and will not be validated by any Google
services.</p>

<pre class="prettyprint">
URL: http://maps.googleapis.com/maps/api/geocode/json?address=New+York&amp;sensor=false&amp;client=<i>clientID</i>
Private Key: vNIXE0xscrmjlyV-12Nj_BvUPaw=
URL Portion to Sign: /maps/api/geocode/json?address=New+York&amp;sensor=false&amp;client=<i>clientID</i>
Signature: KrU1TzVQM7Ur0i8i7K3huiw3MsA=
Full Signed URL: http://maps.googleapis.com/maps/api/geocode/json?address=New+York&amp;sensor=false&amp;client=<i>clientID</i>&amp;signature=KrU1TzVQM7Ur0i8i7K3huiw3MsA=
</pre>

<h3 id="PythonSignatureExample">Example: Signing a URL in Python</h3>

<p>The example below uses standard Python libraries to sign a URL
and output a proper URL request.</p>

<p><img id="pythonicon" src="../images/minus.png" onclick="toggle('pythoncode','pythonicon');"/>&nbsp;Show/Hide Code</p>
<div class="codedisplay" id="pythoncode">
<pre class="prettyprint">
#!/usr/bin/env python2.7
# coding: utf8

import sys
import hashlib
import urllib
import hmac
import base64
import urlparse

print("")
print("URL Signer 1.0")
print("")

# Convert the URL string to a URL, which we can parse
# using the urlparse() function into path and query
# Note that this URL should already be URL-encoded
url = urlparse.urlparse("<i>YOUR_URL_TO_SIGN</i>")

privateKey = "<i>YOUR_PRIVATE_KEY</i>"

# We only need to sign the path+query part of the string
urlToSign = url.path + "?" + url.query

# Decode the private key into its binary format
decodedKey = base64.urlsafe_b64decode(privateKey)

# Create a signature using the private key and the URL-encoded
# string using HMAC SHA1. This signature will be binary.
signature = hmac.new(decodedKey, urlToSign, hashlib.sha1)

# Encode the binary signature into base64 for use within a URL
encodedSignature = base64.urlsafe_b64encode(signature.digest())
originalUrl = url.scheme + "://" + url.netloc + url.path + "?" + url.query
print("Full URL: " + originalUrl + "&amp;signature=" + encodedSignature)
</pre>
</div>

<p>Download the code from
<a href="http://gmaps-samples.googlecode.com/svn/trunk/urlsigning/urlsigner.py">gmaps-samples</a></p>

<h3 id="JavaSignatureExample">Example: Signing a URL in Java</h3>

<p>The example below uses this <a href="http://iharder.sourceforge.net/current/java/base64/">
public domain Base64 encoding class</a> to sign a URL
and output a proper URL request. (Be sure to include that class in
your <code>CLASSPATH</code> when compiling the Java code shown
below.)</p>

<p><img id="javaicon" src="../images/plus.png" onclick="toggle('javacode','javaicon');"/>&nbsp;Show/Hide Code</p>
<div class="codedisplay" style="display:none" id="javacode">

<pre class="prettyprint">
public class UrlSigner {

  // Note: Generally, you should store your private key someplace safe
  // and read them into your code

  private static String keyString = "<i>YOUR_PRIVATE_KEY</i>";
  
  // The URL shown in these examples must be already
  // URL-encoded. In practice, you will likely have code
  // which assembles your URL from user or web service input
  // and plugs those values into its parameters.
  private static String urlString = "<i>YOUR_URL_TO_SIGN</i>";

  // This variable stores the binary key, which is computed from the string (Base64) key
  private static byte[] key;
  
  public static void main(String[] args) throws IOException,
    InvalidKeyException, NoSuchAlgorithmException, URISyntaxException {
    
    // Convert the string to a URL so we can parse it
    URL url = new URL(urlString);
    
    UrlSigner signer = new UrlSigner(keyString);
    String request = signer.signRequest(url.getPath(),url.getQuery());
    
    System.out.println("Signed URL :" + url.getProtocol() + "://" + url.getHost() + request);
  }
  
  public UrlSigner(String keyString) throws IOException {
    // Convert the key from 'web safe' base 64 to binary
    keyString = keyString.replace('-', '+');
    keyString = keyString.replace('_', '/');
    System.out.println("Key: " + keyString);
    this.key = Base64.decode(keyString);
  }

  public String signRequest(String path, String query) throws NoSuchAlgorithmException,
    InvalidKeyException, UnsupportedEncodingException, URISyntaxException {
    
    // Retrieve the proper URL components to sign
    String resource = path + '?' + query;
    
    // Get an HMAC-SHA1 signing key from the raw key bytes
    SecretKeySpec sha1Key = new SecretKeySpec(key, "HmacSHA1");

    // Get an HMAC-SHA1 Mac instance and initialize it with the HMAC-SHA1 key
    Mac mac = Mac.getInstance("HmacSHA1");
    mac.init(sha1Key);

    // compute the binary signature for the request
    byte[] sigBytes = mac.doFinal(resource.getBytes());

    // base 64 encode the binary signature
    String signature = Base64.encodeBytes(sigBytes);
    
    // convert the signature to 'web safe' base 64
    signature = signature.replace('+', '-');
    signature = signature.replace('/', '_');
    
    return resource + "&amp;signature=" + signature;
  }
}

</pre>

</div>

<p>Download the code from
<a href="http://gmaps-samples.googlecode.com/svn/trunk/urlsigning/UrlSigner.java">gmaps-samples</a></p>


<h3 id="CSharpSignatureExample">Example: Signing a URL in C#</h3>

<p>The example below uses the default
<code>System.Security.Cryptography</code> library to sign a URL request
and output a proper URL request. Note that we need to convert the
default Base64 encoding to implement an URL-safe version.</p>

<p><img id="csharpicon" src="../images/plus.png" onclick="toggle('csharpcode','csharpicon');"/>&nbsp;Show/Hide Code</p>
<div class="codedisplay" style="display:none" id="csharpcode">

<pre class="prettyprint">
using System;
using System.Collections.Generic;
using System.Security.Cryptography;
using System.Text;
using System.Text.RegularExpressions;
using System.Web;

namespace SignUrl {

  public struct GoogleSignedUrl {

    public static string Sign(string url, string keyString) {
      ASCIIEncoding encoding = new ASCIIEncoding();

      // converting key to bytes will throw an exception, need to replace '-' and '_' characters first.
      string usablePrivateKey = keyString.Replace("-", "+").Replace("_", "/");
      byte[] privateKeyBytes = Convert.FromBase64String(usablePrivateKey);

      Uri uri = new Uri(url);
      byte[] encodedPathAndQueryBytes = encoding.GetBytes(uri.LocalPath + uri.Query);

      // compute the hash
      HMACSHA1 algorithm = new HMACSHA1(privateKeyBytes);
      byte[] hash = algorithm.ComputeHash(encodedPathAndQueryBytes);

      // convert the bytes to string and make url-safe by replacing '+' and '/' characters
      string signature = Convert.ToBase64String(hash).Replace("+", "-").Replace("/", "_");
            
      // Add the signature to the existing URI.
      return uri.Scheme+"://"+uri.Host+uri.LocalPath + uri.Query +"&amp;signature=" + signature;
    }
  }

  class Program {

    static void Main() {

      // Note: Generally, you should store your private key someplace safe
      // and read them into your code

      const string keyString = "<i>YOUR_PRIVATE_KEY</i>";

      // The URL shown here is a static URL which should be already
      // URL-encoded. In practice, you will likely have code
      // which assembles your URL from user or web service input
      // and plugs those values into its parameters.
      const  string urlString = "<i>YOUR_URL_TO_SIGN</i>";

      Console.WriteLine(GoogleSignedUrl.Sign(urlString,keyString));
    }
  }
}
</pre>

</div>

<p>Download the code from
<a href="http://gmaps-samples.googlecode.com/svn/trunk/urlsigning/UrlSigner.cs">gmaps-samples</a></p>

<h3 id="MoreSignatureExamples">Signing URLs: Examples in Additional Languages</h3>
<p>Examples that cover more languages are available on
<a
href="http://gmaps-samples.googlecode.com/svn/trunk/urlsigning/index.html">gmaps-samples</a>.</p>

<h1 id="Parsing">Processing Responses</h1>

<p class="note">As the exact format of individual responses with a
web service request is not guaranteed (some elements may be missing
or in multiple locations), you should never assume that the
format returned for any given response will be the same for different
queries. Instead, you should <b>process</b> the response and select
appropriate values via <b>expressions</b>. This section discusses
how to extract these values dynamically from web service responses.</p>

<p>The Google Web Services provide responses which are easy to
understand, but not exactly user friendly. When performing a query, rather
than display a set of data, you probably want to extract a few specific
values. Generally, you will want to parse responses from the web
service and extract only those values which interest you.</p>

<p>The parsing scheme you use depends on whether you are returning
output in XML or JSON. JSON responses, being already in the form of
Javascript objects, may be processed within Javascript itself
on the client; XML responses should be processed using an XML processor
and an XML query language to address elements within the XML format.
We use <a href="http://http://www.w3.org/TR/xpath/">XPath</a> in the
following examples, as it is commonly supported in XML processing
libraries.</p>

<h2 id="ParsingXML">Processing XML with XPath</h2>

<p>XML is a relatively mature structured information format used for
data interchange. Although it is not as lightweight as JSON, XML
does provide more language support and more robust tools. Code for
processing XML in Java, for example, is built into the
<code><b>javax.xml</b></code> packages.</p>

<p>When processing XML responses, you should use an appropriate
query language for selecting nodes within the XML document, rather
than assume the elements reside at absolute positions within the
XML markup. <a href="http://en.wikipedia.org/wiki/XPath">XPath</a>
is a language syntax for uniquely describing nodes and elements
within an XML document. XPath expressions allow you to identify
specific content within the XML response document.</p>

<h3 id="XPathExpressions">XPath Expressions</h3>

<p>Some familiarity with XPath goes a long way towards developing
a robust parsing scheme. This section will focus on how elements
within an XML document are addressed with XPath, allowing you to
address multiple elements and construct complex queries.</p>

<p>XPath uses <i>expressions</i> to select elements within an XML
document, using a syntax similar to that used for directory paths.
These expressions identify elements within an XML document
tree, which is a hierarchical tree similar to that of a DOM.
Generally, XPath expressions are greedy, indicating that they
will match all nodes which match the supplied criteria.</p>

<p>We'll use the following abstract XML to illustrate our
examples:</p>

<pre class="prettyprint">
&lt;WebServiceResponse&gt; 
 &lt;status&gt;OK&lt;/status&gt; 
 &lt;result&gt; 
  &lt;type&gt;sample&lt;/type&gt; 
  &lt;name&gt;Sample XML&lt;/formatted_address&gt; 
  &lt;location&gt; 
   &lt;lat&gt;37.4217550&lt;/lat&gt; 
   &lt;lng&gt;-122.0846330&lt;/lng&gt; 
  &lt;/location&gt; 
 &lt;/result&gt;
 &lt;result&gt;
  &lt;message&gt;The secret message&lt;/message&gt;
 &lt;/result&gt; 
&lt;/WebServiceResponse&gt; 
</pre>

<h4 id="NodeSelection">Node Selection in Expressions</h4>

<p>XPath selections select <i>nodes</i>. The root node
encompasses the entire document. You select this node using
the special expression "<code>/</code>". Note that the root
node is not the top-level node of your XML document; actually,
it resides one level above this top-level element and includes
it.</p>

<p>Element nodes represent the various elements within the XML
document tree. A <code>&lt;WebServiceResponse&gt;</code> element,
for example, represents the top-level element returned in our
sample service above. You select individual nodes either via
absolute or relative paths, indicated by the presence or
absence of a leading "<code>/</code>" character.</p>

<ul>
  <li>Absolute path: the "<code>/WebServiceResponse/result</code>"
  expression selects all <code>&lt;result&gt;</code> nodes that
  are children of the <code>&lt;WebServiceResponse&gt;</code>
  node. (Note that both of these elements descend from the root
  node "<code>/</code>".)</p></li>
  <li>Relative path from the current context: the expression
  "<code>result</code>" would match any <code>&lt;result&gt;</code>
  elements within the current context. Generally, you shouldn't
  have to worry about context, as you're usually processing web
  service results via a single expression.</li>
</ul>

<p>Either of these expressions may be augmented through addition
of a wildcard path, indicated with a double-slash ("<code>//</code>").
This wildcard indicates that zero or more elements may match in the
intervening path. The XPath expression "<code>//formatted_address</code>,"
for example, will match all nodes of that name in the current document.
The expression <code>//viewport//lat</code> would match all
<code>&lt;lat&gt;</code> elements that can trace <code>&lt;viewport&gt;</code>
as a parent.</p>

<p>By default, XPath expressions match all elements. You can restrict
the expression to match a certain element by providing a <i>predicate</i>,
which is enclosed in square brackets (<code>[]</code>). The XPath
expression "<code>/GeocodeResponse/result[2]</code> always returns the
second result, for example.</p>

<table>
<tr>
<th>XPath Expression</th><th>Type of Expression</th><th>Selection</th>
</tr>
<tr>
<td>"<code>/</code>"</td><td>Root node</td>
<td>
<pre class="prettyprint">
&lt;WebServiceResponse&gt; 
 &lt;status&gt;OK&lt;/status&gt; 
 &lt;result&gt; 
  &lt;type&gt;sample&lt;/type&gt; 
  &lt;name&gt;Sample XML&lt;/formatted_address&gt; 
  &lt;location&gt; 
   &lt;lat&gt;37.4217550&lt;/lat&gt; 
   &lt;lng&gt;-122.0846330&lt;/lng&gt; 
  &lt;/location&gt; 
 &lt;/result&gt;
 &lt;result&gt;
  &lt;message&gt;The secret message&lt;/message&gt;
 &lt;/result&gt; 
&lt;/WebServiceResponse&gt; 
</pre>
</td>
</tr>
<tr>
<td>"<code>/WebServiceResponse/result</code>"</td><td>Absolute Path</td><td>
<pre class="prettyprint">
&lt;result&gt; 
 &lt;type&gt;sample&lt;/type&gt; 
 &lt;name&gt;Sample XML&lt;/formatted_address&gt; 
 &lt;location&gt; 
  &lt;lat&gt;37.4217550&lt;/lat&gt; 
  &lt;lng&gt;-122.0846330&lt;/lng&gt; 
 &lt;/location&gt; 
&lt;/result&gt;
&lt;result&gt;
 &lt;message&gt;The secret message&lt;/message&gt;
&lt;/result&gt;
</pre>
</td>
</tr>
<tr>
<td>"<code>/WebServiceResponse//location</code>"</td><td>Path with Wildcard</td>
<td>
<pre class="prettyprint">
&lt;location&gt; 
 &lt;lat&gt;37.4217550&lt;/lat&gt; 
 &lt;lng&gt;-122.0846330&lt;/lng&gt; 
&lt;/location&gt; 
</pre>
</td>
</tr>
<tr>
<td>"<code>/WebServiceResponse/result[2]/message</code>"</td><td>Path with Predicate</td>
<td>
<pre class="prettyprint">
&lt;message&gt;The secret message&lt;/message&gt;
</pre>
</td>
</tr>
<tr>
<td>"<code>/WebServiceResponse/result[1]/*</code>"</td><td>All direct children of the first <code>result</code></td>
<td>
<pre class="prettyprint">
 &lt;type&gt;sample&lt;/type&gt; 
 &lt;name&gt;Sample XML&lt;/formatted_address&gt; 
 &lt;location&gt; 
  &lt;lat&gt;37.4217550&lt;/lat&gt; 
  &lt;lng&gt;-122.0846330&lt;/lng&gt; 
 &lt;/location&gt; 
</pre>
</td>
</tr>
<tr>
<td>"<code>/WebServiceResponse/result[type/text()='sample']/name</code>"</td><td>The <code>name</code> of a
<code>result</code> whose <code>type</code> text is "sample."</td>
<td>
<pre class="prettyprint">
Sample XML 
</pre>
</td>
</tr>

</table>

<p>It is important to note that when selecting elements, you select nodes,
not just the text within those objects. Generally, you
will want to iterate over all matched nodes and extract the text. You
may also match text nodes directly; see <a href="#Text">Text Nodes
</a> below.</p>

<p class="note">Note that XPath supports attribute nodes as well; however,
all Google Maps web services serve elements without attributes, so
matching of attributes is not necessary.</p>

<h4 id="TextSelection">Text Selection in Expressions</h4>

<p>Text within an XML document is specified in XPath expressions
via a <i>text node</i> operator. This operator "<code>text()</code>"
indicates extraction of text from the indicated node. For example,
the XPath expression "<code>//formatted_address/text()</code>" will
return all text within <code>&lt;formatted_address&gt;</code>
elements.</p>

<table>
<tr>
<th>XPath Expression</th><th>Type of Expression</th><th>Selection</th>
</tr>
<tr>
<td>"<code>//text()</code>"</td><td>All text nodes (including whitespace)</td>
<td>
<pre class="prettyprint">

sample
Sample XML

37.4217550
-122.0846330
The secret message
</pre>
</td>
</tr>
<td>"<code>/WebServiceRequest/result[2]/message/text()</code>"</td>
<td>Text Selection</td>
<td>
<pre class="prettyprint">
The secret message
</pre>
</td>
</tr>
<tr>
<td>"<code>/WebServiceRequest/result[type/text() = 'sample']/name/text()</code>"</td>
<td>Context Sensitive Selection.</td>
<td>
<pre class="prettyprint">
Sample XML
</pre>
</td>
</tr>
<tr>
</table>

<p>Alternatively, you may evaluate an expression and return a set
of nodes and then iterate over that "node set," extracting the
text from each node. We use this approach in the example below.</p>

<p>For more information on XPath, consult the
<a href="http://www.w3.org/TR/xpath/">XPath W3C Specification</a>.</p>

<h3 id="XPathJavaProcessing">Evaluating <b>XPath</b> in Java</h3>

<p>Java has wide support for parsing XML and using XPath expressions
within the <code>javax.xml.xpath.*</code> package.
For that reason, the sample code in this section uses Java to
illustrate how to handle XML and parse data from XML service responses.
</p>

<p>To use XPath in your Java code, you will first need to instantiate
an instance of an <code><b>XPathFactory</b></code> and call
<code>newXPath()</code> on that factory to create an <code><b>XPath
</b></code> object. This object can then process passed XML
and XPath expressions using the <code>evaluate()</code> method.</p>

<p>When evaluating XPath expressions, make sure that you iterate
over any possible "node sets" which may be returned. Because these
results are returned as DOM nodes in Java code, you should capture
such multiple values within a <code>NodeList</code> object and
iterate over that object to extract any text or values from those
nodes.</p>

<p>The following code illustrates how to create an <code>XPath</code>
object, assign it XML and an XPath expression, and evaluate the
expression to print out the relevant content.</p>


<pre class="prettyprint">
import org.xml.sax.InputSource;
import org.w3c.dom.*;
import javax.xml.xpath.*;
import java.io.*;

public class SimpleParser {

  public static void main(String[] args) throws IOException {
 
	XPathFactory factory = XPathFactory.newInstance();

    XPath xpath = factory.newXPath();

    try {
      System.out.print("Web Service Parser 1.0\n");

      // In practice, you'd retrieve your XML via an HTTP request.
      // Here we simply access an existing file.
      File xmlFile = new File("<i>XML_FILE</i>");

      // The xpath evaluator requires the XML be in the format of an InputSource
	  InputSource inputXml = new InputSource(new FileInputStream(xmlFile));

      // Because the evaluator may return multiple entries, we specify that the expression
      // return a NODESET and place the result in a NodeList.
      NodeList nodes = (NodeList) xpath.evaluate("<i>XPATH_EXPRESSION</i>", inputXml, XPathConstants.NODESET);

      // We can then iterate over the NodeList and extract the content via getTextContent().
      // NOTE: this will only return text for element nodes at the returned context.
      for (int i = 0, n = nodes.getLength(); i < n; i++) {
        String nodeString = nodes.item(i).getTextContent();
        System.out.print(nodeString);
        System.out.print("\n");
      }
    } catch (XPathExpressionException ex) {
	  System.out.print("XPath Error");
    } catch (FileNotFoundException ex) {
      System.out.print("File Error");
    }
  }
}
</pre>


<p>Download the code from
<a href="http://gmaps-samples.googlecode.com/svn/trunk/webservices/java/SimpleParser.java">gmaps-samples</a></p>

<h2 id="ParsingJSON">Processing JSON with Javascript</h2>

<p>JSON (Javascript Object Notation) has an obvious advantage over
XML in that the response is lightweight. Parsing such a result is
trivial in JavaScript as the format is already a valid Javascript
object. For example, to extract the value of the
<code>'formatted_address'</code> keys within a JSON result object,
simply access them using the following code:</p>


<pre class="prettyprint">
for (i = 0; i < myJSONResult.results.length; i++) {
  myAddress[i] = myJSONResult.results[i].formatted_address;
}
</pre>


<p>Note that because JSON may contain multiple values, it's
wisest to iterate over the length of the <code>results</code>
array if you want to capture all possible values. In practice,
you may wish to only return the first result (<code>results[0]</code>),
however.</p>

<p>Parsing JSON in other languages is only moderately more difficult.
The following Python example initiates a Geocoding web service request
and displays all resulting <code>formatted_address</code> values
to the user within an array:</p>


<pre class="prettyprint">
import simplejson, urllib

GEOCODE_BASE_URL = 'http://maps.googleapis.com/maps/api/geocode/json'

def geocode(address,sensor, **geo_args):
    geo_args.update({
        'address': address,
        'sensor': sensor  
    })

    url = GEOCODE_BASE_URL + '?' + urllib.urlencode(geo_args)
    result = simplejson.load(urllib.urlopen(url))

    print simplejson.dumps([s['formatted_address'] for s in result['results']], indent=2)

if __name__ == '__main__':
    geocode(address="San+Francisco",sensor="false")
<hr></hr>
Output: 
<b>
[
  "San Francisco, CA, USA"
]
</b>
</pre>


<p>Download the code from
<a href="http://gmaps-samples.googlecode.com/svn/trunk/geocoder/python/SimpleParser.py">gmaps-samples</a></p>


        <!-- end body text -->

   
      </div><!-- end gc-pagecontent -->
   </div><!-- end gooey wrapper -->

    </div> <!-- end codesite content -->


<div id="gc-footer" dir="ltr">
  <div class="text">
    
    &copy;2010 Google -
    <a href="http://code.google.com">Code Home</a> -
    <a href="http://code.google.com/terms.html">Terms of Service</a> -
    <a href="http://code.google.com/privacy.html">Privacy Policy</a> -
    <a href="http://code.google.com/more">Site Directory</a>
    <br> <br>
    Google Code offered in:
    <a href="http://code.google.com/intl/en">English</a> -
    <a href="http://code.google.com/intl/es">Español</a> -
    <a href="http://code.google.com/intl/ja">日本語</a> -
    <a href="http://code.google.com/intl/ko">한국어</a> -
    <a href="http://code.google.com/intl/pt-BR">Português</a> -
    <a href="http://code.google.com/intl/ru">Pусский</a> -
    <a href="http://code.google.com/intl/zh-CN">中文(简体)</a> -
    <a href="http://code.google.com/intl/zh-TW">中文(繁體)</a>
  </div>
</div><!-- end gc-footer -->

</div><!-- end gc-container -->

<script type="text/javascript">CODESITE_CSITimer['load'].tick('ats');</script>
<script src="../../../../js/codesite_tail.pack.04102009.js" type="text/javascript"></script>




<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(


    ['siteTracker._setAccount', 'UA-18071-1'],
    ['siteTracker._setDomainName', 'code.google.com'],
    ['siteTracker._setCookiePath', window.location.pathname.substring(0,
        window.location.pathname.lastIndexOf('/') + 1)],
    ['siteTracker._trackPageview']
);
(function() {
  var ga = document.createElement('script');

  ga.type = 'text/javascript';
  ga.async = true;
  ga.src = 'http://www.google-analytics.com/ga.js';
  (document.getElementsByTagName('head')[0] ||
   document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
</script>




  </body>
</html>

