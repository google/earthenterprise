

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Create custom masks &#8212; Google Earth Enterprise 5.3.7 documentation</title>
    <link rel="stylesheet" href="../../static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
    <script type="text/javascript" src="../../static/jquery.js"></script>
    <script type="text/javascript" src="../../static/underscore.js"></script>
    <script type="text/javascript" src="../../static/doctools.js"></script>
    <script type="text/javascript" src="../../static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Manage mosaics with virtual rasters" href="manageMosaicsWithVirtualRasters.html" />
    <link rel="prev" title="Google Maps raster background" href="googleMapsRasterBg.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="manageMosaicsWithVirtualRasters.html" title="Manage mosaics with virtual rasters"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="googleMapsRasterBg.html" title="Google Maps raster background"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Google Earth Enterprise 5.3.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../fusionResAndProj.html" accesskey="U">Fusion Resources and Projects</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="googleMapsRasterBg.html"
                        title="previous chapter">Google Maps raster background</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="manageMosaicsWithVirtualRasters.html"
                        title="next chapter">Manage mosaics with virtual rasters</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p><a class="reference internal" href="../../images/googlelogo_color_260x88dp2.png"><img alt="Google logo" src="../../images/googlelogo_color_260x88dp2.png" style="width: 130px; height: 44px;" /></a></p>
<div class="section" id="create-custom-masks">
<h1>Create custom masks<a class="headerlink" href="#create-custom-masks" title="Permalink to this headline">¶</a></h1>
<div class="docutils container">
<div class="content docutils container">
<p class="rubric">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#getting-started"><span class="std std-ref">Getting started</span></a></li>
<li><a class="reference internal" href="#how-use-guide"><span class="std std-ref">How to use this guide</span></a></li>
<li><a class="reference internal" href="#what-gepolymaskgen"><span class="std std-ref">What is gepolymaskgen?</span></a></li>
<li><a class="reference internal" href="#what-gemaskgen"><span class="std std-ref">What is gemaskgen?</span></a></li>
<li><a class="reference internal" href="#useful-info-gepolymaskgen"><span class="std std-ref">Useful information about gepolymaskgen</span></a></li>
<li><a class="reference internal" href="#useful-info-gemaskgen"><span class="std std-ref">Useful information about gemaskgen</span></a></li>
<li><a class="reference internal" href="#when-use-gepolymaskgen"><span class="std std-ref">When to use gepolymaskgen</span></a></li>
<li><a class="reference internal" href="#when-use-gemaskgen"><span class="std std-ref">When to use gemaskgen</span></a></li>
<li><a class="reference internal" href="#recommended-tools-mask-filters"><span class="std std-ref">Recommended tools for creating custom mask
files</span></a></li>
<li><a class="reference internal" href="#gepolymaskgen-command-usage"><span class="std std-ref">gepolymaskgen command usage</span></a></li>
<li><a class="reference internal" href="#example-use-cases-commands"><span class="std std-ref">Example use cases and commands to build custom
masks</span></a><ul>
<li><a class="reference internal" href="#imagery-no-fill-pixels"><span class="std std-ref">Case 1: Create custom masks for imagery which has no fill
pixels (usable imagery goes to the
edges)</span></a><ul>
<li><a class="reference internal" href="#edge-match-no-feather"><span class="std std-ref">Example A: Creating an edge-matched mask with no
feather</span></a></li>
<li><a class="reference internal" href="#edge-mask-fixed-feather"><span class="std std-ref">Example B: Creating an edge-matched mask with a fixed
value feather</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-mask-islands"><span class="std std-ref">Case 2: Create custom masks for
islands</span></a><ul>
<li><a class="reference internal" href="#island-masks-into-land"><span class="std std-ref">Example A: Create a custom edge-matched mask for an
island that masks into the land</span></a></li>
<li><a class="reference internal" href="#island-masks-into-water"><span class="std std-ref">Example B: Create a custom edge-matched mask for an
island that masks into the water</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#masks-coastline-shared-edges"><span class="std std-ref">Case 3: Create custom masks with coastlines and shared
edges with other imagery resources</span></a><ul>
<li><a class="reference internal" href="#coastline-external-edges-same-values"><span class="std std-ref">Example A: Create an edge-matched custom mask that
feathers coastlines and external edges with the same
feather value</span></a></li>
<li><a class="reference internal" href="#feathered-coastlines-external-edges"><span class="std std-ref">Example B: Create an edge-matched custom mask with
feathered coastlines and feathered external
edges</span></a></li>
<li><a class="reference internal" href="#feathered-internal-coastline-no-edge"><span class="std std-ref">Example C: Feathered internal coastline and no-feather
external edge</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#masking-out-sections-large-image"><span class="std std-ref">Case 4: Masking out sections within an image
resource</span></a><ul>
<li><a class="reference internal" href="#feathered-edge-masking-missing-internal-imagery-one-step"><span class="std std-ref">Example A: Creating an edge-matched mask with a
feathered edge and masking missing internal imagery in
one step</span></a></li>
<li><a class="reference internal" href="#feathered-edge-masking-missing-internal-imagery-two-step"><span class="std std-ref">Example B: Creating an edge-matched mask with a
feathered edge and masking missing internal imagery in
two steps</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5: Building custom masks with both gemaskgen and
gepolymaskgen</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A: Importing custom masks with imagery and terrain
resources in Google Earth Enterprise Fusion
Pro</span></a><ul>
<li><a class="reference internal" href="#enable-havemask-new-image-resource"><span class="std std-ref">Example 1: Enable havemask mode in the Fusion GUI for a new
image resource</span></a></li>
<li><a class="reference internal" href="#enable-havemask-command-line-new-image-resource"><span class="std std-ref">Example 2: Enable havemask mode by command line for a new
image resource</span></a></li>
<li><a class="reference internal" href="#enable-havemask-existing-image-resource"><span class="std std-ref">Example 3: Enable havemask mode in the Fusion GUI for an
existing image resource</span></a></li>
<li><a class="reference internal" href="#enable-havemask-command-line-existing-image-resource"><span class="std std-ref">Example 4: Enable havemask mode by command line for an
existing image resource</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#locating-mask-files-format-data-asset-root"><span class="std std-ref">Appendix B: Locating mask files and Fusion format data in an
Asset Root</span></a><ul>
<li><a class="reference internal" href="#locate-fusion-format-imagery-mask-files-image-resource"><span class="std std-ref">Example 1: Locate the Fusion format imagery (.kip) and mask
(.kmp) files of an image resource</span></a></li>
<li><a class="reference internal" href="#locate-mask-file-built-automask-fusion-build"><span class="std std-ref">Example 2: Locate a mask.tif file automatically built by
the automask feature of a Fusion resource
build</span></a></li>
<li><a class="reference internal" href="#locate-mask-file-fusion-format-file-building-mask-product"><span class="std std-ref">Example 3: Locate the mask.tif file and Fusion format .kip
file utilized for building the Fusion format .kmp (mask
product)</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">Appendix C: Determining source file raster size with
geinfo</span></a><ul>
<li><a class="reference internal" href="#maximum-suggested-raster-dimensions-source-files-gepolymaskgen"><span class="std std-ref">Maximum suggested raster dimensions for source files used
as gepolymaskgen –base_image files</span></a></li>
<li><a class="reference internal" href="#square-shaped-rasters"><span class="std std-ref">Square-shaped rasters</span></a></li>
<li><a class="reference internal" href="#rectangular-sharped-rasters"><span class="std std-ref">Rectangular-shaped rasters</span></a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix D: Building high resolution mask files with
gemaskgen</span></a></li>
<li><a class="reference internal" href="#using-photo-editing-app-augment-custom-app"><span class="std std-ref">Appendix E: Using a Photo Editing application to augment a
custom mask</span></a></li>
<li><a class="reference internal" href="#building-custom-masks-large-source-imagery"><span class="std std-ref">Appendix F: Building custom masks for large source
imagery</span></a></li>
<li><a class="reference internal" href="#gepolymaskgen-help-menu"><span class="std std-ref">Appendix G: Gepolymaskgen help menu</span></a></li>
</ul>
<p class="rubric" id="getting-started">Getting started</p>
<p>A new masking tool is now available with Google Earth Enterprise
(GEE) Fusion Pro version 4.0 which is able to create very high
quality, custom masks for imagery resources. This tool,
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>, supports clipping coastlines from imagery
resources or arbitrary polygonal shapes from imagery resources,
and can be integrated into source file preparation or creating
updated masks for existing imagery resources.</p>
<p class="rubric" id="how-use-guide">How to use this guide</p>
<p>This guide is intended to provide in-depth information about
creating custom masks, the new <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> tool, and the
existing <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> tool, as well as example cases with command
sequences to build your own custom masks. You may jump directly to
the cases section to build your custom masks and then read the
informational sections later, or read the entire guide from start
to finish.</p>
<p class="rubric" id="what-gepolymaskgen">What is gepolymaskgen?</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is a new low-level GEE Fusion Pro tool capable
of creating a mask file for a single source image, mosaicked
source imagery set, or a GEE Fusion Pro imagery resource based on
user-specified masking options. With this tool, users can
programmatically create masks for imagery that follows a shoreline,
create masks at a fixed feather value, or augment mask files with
KML polygons from Google Earth to show or hide imagery through a
mask. The <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> tool has two key differences from the
existing automask tool <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>: 1) <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> only
fulfills operations specified by users and does not operate
automatically in the same manner as <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>; 2)
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> may only be invoked by the command line,
separately from the normal automated GEE resource import
sequences.</p>
<p class="rubric" id="what-gemaskgen">What is gemaskgen?</p>
<p><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> is an existing low-level masking tool bundled with
GEE Fusion Pro that is invoked by Fusion when building an imagery
or terrain resource. The <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> tool was designed to
automatically build mask files for imported source imagery and
terrain data to hide external, or internal, fill data from view on
the globe. In order to build the mask, users must specify within
the Resource Editing tool which band (Red, Green, or Blue) should
be used to create the mask; the amount of feathering that should
be applied between the fill data (masked) and the usable imagery;
a tolerance value (buffer) that may be applied by the tool when
checking if a pixel is fill value or not; if the entire image
should be checked for fill data (holes); and if both white and
black fill data should be included in the mask (0 is assumed
default, 255 to be included).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> tool will be invoked by GEE Fusion Pro after the
source imagery is converted into Fusion format (<code class="docutils literal notranslate"><span class="pre">kip</span></code>).
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> collects the value for each corner pixel on band 1
of the image resource - which is assumed to be the fill data pixel
value (0 is the typical value) - and then systematically moves
through the <code class="docutils literal notranslate"><span class="pre">kip</span></code> adding all fill data into the mask until
non-fill data is found. The edge between the fill data and usable
imagery is feathered based on the user-specified feather value (in
pixels). The new GEE Fusion Pro imagery or terrain resource is
comprised of both the imported source data and the computed mask
file as demonstrated in the graphic below.</p>
<p><img alt="Masked imagery diagram" src="../../images/image10.jpg" /></p>
<p class="rubric" id="useful-info-gepolymaskgen">Useful information about gepolymaskgen</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is a single-threaded low-level GEE Fusion
command-line tool that may be manually invoked for building
custom mask files for imagery or terrain data sets</li>
<li>Operationally, <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is CPU-intensive and <em>very</em>
RAM-intensive.<ul>
<li>At least 16GB free RAM must be available on the machine to
safely build custom masks with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>.</li>
</ul>
</li>
<li>All mask files built by <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> will be written out
in <code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code> format.</li>
<li>Mask files will be written with complementary geographic
coordinates and projection to the source data.<ul>
<li>All mask files, KML polygons, vector source files, and
source imagery should be in the same projection for building
custom masks.</li>
<li>Masks may be built for resources in Plate-Carre projection
(EPSG:4326) or Mercator projection (EPSG:3857).</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> can build a mask for one source file or many
source files that are described with a <code class="docutils literal notranslate"><span class="pre">khvr</span></code> virtual raster
text file.</li>
<li>Mask files built by <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> will use 255 to show
imagery and 0 to hide imagery.<ul>
<li>All new masks start as an image file with all pixels of
value 0 - all imagery will be masked.</li>
<li>Areas to hide (to be masked) will be set to pixel value 0.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--or_mask</span></code> masking operator will, typically, show
more imagery for an area in the final mask.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code> masking operator will, typically,
hide more imagery for an area in the final mask.</li>
</ul>
</li>
<li>The final mask is built by subtracting and adding desired areas
to hide or view by a sequence of operators.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is easy to create very high resolution masks with
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>, to the point of pixel-by-pixel matching for
the source imagery. Please check the overall raster size of
your source imagery before creating a custom mask with
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> as it is easy to create a custom mask that
will be larger than the 2GB <code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code> file size limit. Please
see <a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">Appendix C</span></a> for further information
on calculating the overall size of a mask file.</p>
</div>
<p class="rubric" id="useful-info-gemaskgen">Useful information about gemaskgen</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> is a single-threaded low-level Fusion tool which
is automatically called during image and terrain resource
builds after the source imagery or terrain is imported.</li>
<li>All mask files computed by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> will be written out in
<code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code> format.</li>
<li><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> scans through an imported imagery or terrain
resource to:<ul>
<li>identify the pixel value of each corner pixel, and</li>
<li>erode inward into the image to mask out all pixels that have
the same pixel value as the corner pixels.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> will, by default, create an output mask file
which is no more than 16,000 pixels on any one side.<ul>
<li>This can lead to low-resolution masks for high resolution
data.</li>
</ul>
</li>
<li>Masks may be manually created by invoking <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>
directly!<ul>
<li>Masks larger than 16,000 pixels may be created for large
imagery resources with the <code class="docutils literal notranslate"><span class="pre">--maxsize</span></code>option.</li>
<li>Please see <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix D</span></a> for additional
details.</li>
</ul>
</li>
</ul>
<p class="rubric" id="comparison-of-the-gemaskgen-and-gepolymaskgen">Comparison of the gemaskgen and gepolymaskgen</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="50%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Capability</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code></th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Reads Fusion format imagery (.kip) and terrain (.ktp)</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Part of image resource import process</td>
<td>Yes, for automask mode</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Can read source file images including:
<code class="docutils literal notranslate"><span class="pre">khvrs;</span></code>
<code class="docutils literal notranslate"><span class="pre">GeoTIFFs;</span></code>
<code class="docutils literal notranslate"><span class="pre">JPEG2000</span></code></td>
<td>No, can only read Fusion imagery and terrain resource formats</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Can automatically identify and mask Fill Data automatically within imagery resource (holes)</td>
<td>Yes</td>
<td>No, but may be manually removed with KML polygons</td>
</tr>
<tr class="row-even"><td>Can feather a specified amount of pixels from the edge of the image, irrespective of the imagery pixel values</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>Capable of creating high-resolution mask files</td>
<td>Yes, manually possible</td>
<td>Yes - depends on raster dimensions of input source file</td>
</tr>
<tr class="row-even"><td>Can automatically distinguish Fill Data from usable imagery by pixel values</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>Can mask out arbitrary polygonal shapes within the image resource</td>
<td>No</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p class="rubric" id="when-use-gepolymaskgen">When to use gepolymaskgen</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> tool is best suited for when imagery is to
be masked along specific, designated borders - such as coastlines,
boundaries, or a building - or to mask image at a fixed feathering
from the image edge regardless of whether usable imagery or fill data
are at the edge.</p>
<p class="rubric" id="when-use-gemaskgen">When to use gemaskgen</p>
<p>Fusion’s automask (<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>) function is best suited for
automatically creating mask files that detect and hide fill data
while displaying usable (non-fill) imagery. <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> is also
very useful when working with large image resources to create a
base mask that will be less than 2GB in file size but still
facilitate a high fidelity mask.</p>
<p>Please see <a class="reference internal" href="#building-custom-masks-large-source-imagery"><span class="std std-ref">Appendix F</span></a> for further
instructions on how <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> may be utilized with creating
masks for large image resources.</p>
<p class="rubric" id="recommended-tools-mask-filters">Recommended tools for creating custom mask files</p>
<ul class="simple">
<li>A server or workstation with minimum 16GB RAM to build the
custom masks. More RAM is better!</li>
<li>Global coastlines as polygons for coastline masking. <em>Make
certain these are polygons and not lines</em>.</li>
<li>A GIS application, such as QGIS, to view source imagery
datasets. This is helpful in determining if usable imagery is
surrounded by fill data, reprojecting the source imagery, or
combining multiple source files into one image.</li>
<li>A copy of Google Earth EC to connect to and view 3D databases
built with the custom masks for QA testing. Google Earth can
also be used in the masking process by creating KML polygons
for additional areas that are to be masked from view.</li>
<li>A photo editing application such as Adobe Photoshop, GIMP, or
similar, to view the custom mask files after <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>
builds, or to make modifications to the mask file such as
unmasking water bodies or exposing more visible water from a
coastline.</li>
</ul>
<p class="rubric" id="gepolymaskgen-command-usage">gepolymaskgen command usage</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> has a few command line parameters to specify the
workflow for creating a mask. The main workflow is directing
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to create or load an image as a reference for
masking, generating a mask based on desired regions, feathering
the mask edges as needed, and then writing out the resulting mask.
Here are the main <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> options:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code></p>
<ol class="arabic">
<li><p class="first"><strong>Specify which file to reference for creating the mask, or
which existing mask file to load:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--base_image</span></code>: specifies a source file that will be
used for overall raster dimensions, geographic coordinates,
and projection information. May be a <code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code>,
<code class="docutils literal notranslate"><span class="pre">JPEG2000</span></code>, or <code class="docutils literal notranslate"><span class="pre">KHVR</span></code> file. Each <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>
invocation may only include either one <code class="docutils literal notranslate"><span class="pre">--base_image</span></code> or
one <code class="docutils literal notranslate"><span class="pre">--base_mask</span></code> for masking operations.</li>
<li><code class="docutils literal notranslate"><span class="pre">--base_mask</span></code>: specifies a mask file to read in for
further mask processing. The specified file may be a
<code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code>. Each <code class="docutils literal notranslate"><span class="pre">gepolymaskgeninvocation</span></code> may only
include either one <code class="docutils literal notranslate"><span class="pre">--base_image</span></code> or one
<code class="docutils literal notranslate"><span class="pre">--base_mask</span></code>for masking operations.</li>
</ul>
</li>
<li><p class="first"><strong>Modify the mask file by changing what is masked and
feathering:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--feather</span></code>: directs <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to create a
feather along a masked edge by the specified number of
pixels. Either positive or negative values may be specified
with <code class="docutils literal notranslate"><span class="pre">--feather</span></code> to expand or contract the feathered edge
around the masked line. Positive feather settings typically
erode into the usable imagery from the mask line
(contracting) while negative feather settings typically
erode away from the usable imagery from the mask line
(expanding). Using the <code class="docutils literal notranslate"><span class="pre">--invert</span></code> setting with a masking
operation will reverse the effect a <code class="docutils literal notranslate"><span class="pre">--feather</span></code> operation
has on the mask. The <code class="docutils literal notranslate"><span class="pre">--feather</span></code> option may be used with
the <code class="docutils literal notranslate"><span class="pre">--base_image</span></code>, <code class="docutils literal notranslate"><span class="pre">--base_mask</span></code>, <code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code>,
and <code class="docutils literal notranslate"><span class="pre">--or_mask</span></code> mask options; however, only one
<code class="docutils literal notranslate"><span class="pre">--feather</span></code> option may be specified for each operator. The
default feather value for <code class="docutils literal notranslate"><span class="pre">--feather</span></code> is set to 0 pixels.</li>
<li><code class="docutils literal notranslate"><span class="pre">--feather_border</span></code>: used in conjunction only with
<code class="docutils literal notranslate"><span class="pre">--feather</span></code>. Directs <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to apply a
feather to the extent of the mask file with the same
feathering values specified with the <code class="docutils literal notranslate"><span class="pre">--feather</span></code> option.
The <code class="docutils literal notranslate"><span class="pre">--feather_border</span></code> option is off by default.</li>
<li><code class="docutils literal notranslate"><span class="pre">--invert</span></code>: directs <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to invert a
specified mask from its original values to the opposite. In
almost all cases, this involves swapping pixel values from 0
to 255 or 255 to 0, depending on whether the
<code class="docutils literal notranslate"><span class="pre">--base_image</span></code> or <code class="docutils literal notranslate"><span class="pre">--base_mask</span></code> are inverted, or an
<code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code> or<code class="docutils literal notranslate"><span class="pre">--or_mask</span></code> are inverted. Inverting
a mask affects the <code class="docutils literal notranslate"><span class="pre">--feather</span></code> operations as well for
expanding or contracting mask feathering at the specified mask
edges. The <code class="docutils literal notranslate"><span class="pre">--invert</span></code> option may be combined with
<code class="docutils literal notranslate"><span class="pre">--base_image</span></code>, <code class="docutils literal notranslate"><span class="pre">--base_mask</span></code>, <code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code>,
<code class="docutils literal notranslate"><span class="pre">--or_mask</span></code>, or <code class="docutils literal notranslate"><span class="pre">--output_mask</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code>: directs <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to remove
a specified area from view (i.e. subtracting, or masking).
May be combined with the<code class="docutils literal notranslate"><span class="pre">--feather</span></code> and
<code class="docutils literal notranslate"><span class="pre">--feather_border</span></code> options to build a feathered edge along
masked areas. Multiple <code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code>operations may be
combined in one <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> sequence as necessary for
complex mask builds. It is also possible for a
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>sequence to include
both<code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code> and <code class="docutils literal notranslate"><span class="pre">--or_mask</span></code> operations.</li>
<li><code class="docutils literal notranslate"><span class="pre">--or_mask</span></code>: directs <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to add a
specified area into view (i.e. adding, or “unmasking”). May
be combined with the <code class="docutils literal notranslate"><span class="pre">--feather</span></code> and <code class="docutils literal notranslate"><span class="pre">--feather_border</span></code>
options to build a feathered edge along masked areas.
Multiple<code class="docutils literal notranslate"><span class="pre">--or_mask</span></code> operations may be combined in one
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> sequence, as necessary, for complex mask
builds. It is also possible for a <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> sequence
to include both <code class="docutils literal notranslate"><span class="pre">--and_neg_mask</span></code> and
<code class="docutils literal notranslate"><span class="pre">--or_mask</span></code>operations.</li>
</ul>
</li>
<li><p class="first"><strong>Specify the output mask</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--output_mask</span></code>: the folder path location and file name
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is to write the finished mask file. The
completed mask file to import with GEE Fusion Pro must have
the same file name as the source file with a <code class="docutils literal notranslate"><span class="pre">-mask.tif</span></code>
extension. For example, if the source file is
<code class="docutils literal notranslate"><span class="pre">brazil-squareimage-nofill.tif</span></code> the mask file must be
named <code class="docutils literal notranslate"><span class="pre">brazil-squareimage-nofill-mask.tif</span></code>. Only one
<code class="docutils literal notranslate"><span class="pre">--output_mask</span></code> may be specified per
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>operation.</li>
</ul>
<p>As an example, this <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> invocation will create a
zero-feather mask file that edge-matches source data:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">0</span> <span class="pre">--feather_border</span> <span class="pre">0</span> <span class="pre">--base_image</span> <span class="pre">brazil-squareimage-nofill.khvr</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">brazil-squareimage-nofill-mask.tif</span></code></p>
<p>Let’s step through the sequence of events that occur when
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is invoked as noted above.
A new mask file will be created with the same raster dimensions, projection,
and geographic coordinates as the
<code class="docutils literal notranslate"><span class="pre">brazil-squareimage-nofill.khvr</span></code> mosaic file specified with
<code class="docutils literal notranslate"><span class="pre">--base_image</span></code>.
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> will not feather the edge
of the new mask file (<code class="docutils literal notranslate"><span class="pre">--feather</span> <span class="pre">0</span></code>) for which all pixel
values in the mask will be 0.
The <code class="docutils literal notranslate"><span class="pre">--invert</span></code> option directs <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to change the
mask pixel values from 0 to 255 before writing out the finished
mask file <code class="docutils literal notranslate"><span class="pre">brazil-squareimage-nofill-mask.tif</span></code>.
The resulting mask file will look like the image below as viewed in the GIMP
photo editing tool. The resulting image resource, when imported
into GEE Fusion Pro will display all pixels since the mask file
includes edge-to-edge 255 pixels, to display the imagery.
Conversely, if all pixels were value 0 (black), the image would
be fully hidden from view.</p>
<p class="rubric" id="an-edge-matched-zero-feather-mask-file-built-by-gepolymaskgen-as-viewed-in-the-gimp-photo-editing-tool">An edge-matched, zero-feather mask file built by
gepolymaskgen as viewed in the GIMP photo editing tool:</p>
<p><img alt="Hidden masked diagram" src="../../images/image24.jpg" /></p>
<p>All custom mask files can be built with the different
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> masking operators in various combinations to
add or subtract shapes from a mask so only the desired imagery
is visible. Some masking situations may be very complex and
require building multiple mask files with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to
achieve the desired effect. The next section includes some
common use cases for building custom masks as a quick reference
guide so you may see the steps involved and copy and adapt the
commands to suit your own masking needs. These example cases
include creating an edge-matched imagery mask with no
feathering; creating a mask that clips imagery to the coastline
on one side and creates an edge feather on the other side;
masking islands to only show land imagery; and masking sections
within an image.</p>
</li>
</ol>
<p class="rubric" id="example-use-cases-commands">Example use cases and commands to build custom masks</p>
<p>Five example cases are available below to reference for building
custom masks for imagery resources within Google Earth Enterprise
Fusion Pro. Each case or scenario is intended to address common
masking challenges that may be encountered when working with
various source imagery data sets. Each case will include
contextual information for the scenario, workflow description, an
example build with screenshots, and a set of command templates
that may be copied and pasted to the command line of your system
to assist in building a custom mask.</p>
<p>The example cases include:</p>
<p><strong>Case 1</strong>: Creating masks for imagery that has edge-to-edge
usable imagery pixels with a fixed-width feather;</p>
<p><strong>Case 2:</strong> Creating custom masks for islands with coastlines;</p>
<p><strong>Case 3</strong>: Creating a custom mask with coastlines on one side and
a fixed-width feather on other sides;</p>
<p><strong>Case 4</strong>: Custom masks that mask out areas within the image
utilizing a <code class="docutils literal notranslate"><span class="pre">KML</span></code> file;</p>
<p><strong>Case 5</strong>: Creating a custom mask utilizing <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> for
automatic fill detection and <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> for coastline
masking</p>
<p class="rubric" id="imagery-no-fill-pixels">Case 1: Create custom masks for imagery which has no
fill pixels (usable imagery goes to the edges)</p>
<p>Working with source imagery which includes usable imagery to
the image edges can cause problems for the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> tool
since usable imagery pixels (ex: 132, 56, 200), and not fill
pixels (ex: 0, 0, 0), will occupy the image corners that
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> references for fill pixel values. The
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> tool is well-suited to meet this masking
challenge since a mask can be created to the exact raster dimensions
of the image resource, the exact feathering value (0) can be
specified, and <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> will not attempt to read pixel
values. Consider the imagery mosaic below in the middle of Brazil
that includes several source images which include all usable
imagery and no fill.</p>
<p class="rubric">Location of image mosaic as seen with virtual raster
file:</p>
<p><img alt="Brazil Imagery mosaic diagram" src="../../images/image29.jpg" /></p>
<p class="rubric" id="close-up-of-imagery-resource-imported-into-fusion">Close up of imagery resource imported into Fusion:</p>
<p><img alt="Brazil Imagery Fusion import" src="../../images/image40.jpg" /></p>
<p>Since we know the source imagery does not contain fill data, we can
create a custom mask based on the <code class="docutils literal notranslate"><span class="pre">khvr</span></code> virtual mosaic
description file, then include this for import into Fusion. For
this process, <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> will need to know:</p>
<ol class="arabic simple">
<li>The base image to create the mask file from (including location
and raster dimensions)</li>
<li>What feather to apply to the image</li>
<li>If the image border is to be feathered (yes)</li>
<li>What to name the output image</li>
</ol>
<p>Due to how <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> works, we will have to invert the
output mask so the image edge is masked out instead of masking out
the usable imagery. A <code class="docutils literal notranslate"><span class="pre">khvr</span></code> mosaic description file was created
for the collection of <code class="docutils literal notranslate"><span class="pre">JPEG2000</span></code> imagery files with the
<code class="docutils literal notranslate"><span class="pre">gevirtualraster</span></code> command, and this will be used as our base
image since it represents the overall size of the mosaic. The
output mask will be named the same filename as the <code class="docutils literal notranslate"><span class="pre">khvr</span></code> file
but with a <code class="docutils literal notranslate"><span class="pre">-mask.tif</span></code> extension so it may be read into Fusion
Pro. Two masks will be built for this case which are identical
except for the applied feathering value. Part 1 will build an
edge-matched mask with a zero-edge feather to show all pixels of
the source imagery while Part 2 will build an edge-matched mask
with a 100-pixel feather.</p>
<p class="rubric" id="edge-match-no-feather">Example A: Creating an edge-matched mask with no
feather</p>
<p>The <strong>command template</strong> to build a zero-feather, edge-matched
mask file with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">0</span> <span class="pre">--feather_border</span> <span class="pre">0</span> <span class="pre">--base_image</span> <span class="pre">imagery.tif</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">imagery-mask.tif</span></code></p>
<p>Here is output from the console building a working mask file for
the example imagery:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/$</span> <span class="pre">time</span> <span class="pre">/opt/google/bin/gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">0</span> <span class="pre">--feather_border</span> <span class="pre">0</span> <span class="pre">--base_image</span> <span class="pre">brazil-squareimage-nofill.khvr</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">brazil-squareimage-nofill-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">0</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">0</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">brazil-squareimage-nofill.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">brazil-squareimage-nofill.khvr</span> <span class="pre">width:</span> <span class="pre">20480</span> <span class="pre">height:</span> <span class="pre">20480</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">-7.646484e+00</span> <span class="pre">south:</span> <span class="pre">-9.404297e+00</span> <span class="pre">east:</span> <span class="pre">-5.387695e+01</span> <span class="pre">west:</span> <span class="pre">-5.563477e+01</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">brazil-squareimage-nofill-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">0.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">off.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">brazil-squareimage-nofill.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">brazil-squareimage-nofill-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">brazil-squareimage-nofill-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m5.350s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m2.670s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m2.260s</span></code></p>
<p>The resulting mask will be approximately 100MB in file size and
will display all usable imagery in the areas of white pixels.</p>
<p class="rubric">View of the built mask file within the GIMP photo
editing tool with edge-to-edge display of all imagery pixels
for the source file:</p>
<p><img alt="hidden masked diagram" src="../../images/image24.jpg" /></p>
<p class="rubric">View of the image resource after import into Fusion
Pro with the custom mask:</p>
<p><img alt="Fusion Pro with custom mask" src="../../images/image00.jpg" /></p>
<p>Once the mask file is built by <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>, the source
imagery may be imported into Fusion Pro by enabling the
<code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the Fusion GUI or specifying the
<code class="docutils literal notranslate"><span class="pre">--havemask</span></code> option with the <code class="docutils literal notranslate"><span class="pre">genewimageryresource</span></code> or
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span></code> commands.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an image
resource.</p>
<p class="rubric" id="edge-mask-fixed-feather">Example B: Creating an edge-matched mask with a fixed
value feather</p>
<p>The same technique described in Part 1 may also be used for
creating a mask that masks the imagery edge by a specified number
of pixels regardless of the imagery along the edges of the image.
In this case, suppose we have the same 15-meter resolution imagery
for Brazil from Part 1, where each source image includes usable
imagery in each pixel and does not include any fill data borders,
and we wish to create a mask for the entire mosaic that feathers
100 pixels into the image.</p>
<p>The <strong>command template</strong> to build a 100-pixel feathered edge mask
is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">source-image.tif</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">source-image-mask.tif</span></code></p>
<p>The pixel value may be larger than 100 pixels or smaller than 100
pixels to expand the mask into the imagery or toward the imagery
edge as desired for each image and terrain resource.</p>
<p>Here is an example output from g<code class="docutils literal notranslate"><span class="pre">epolymaskgen</span></code> building the
100-pixel feather edge-matched mask for the Brazil imagery:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/$</span> <span class="pre">time</span> <span class="pre">/opt/google/bin/gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">brazil-squareimage-nofill.khvr</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">brazil-squareimage-nofill-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-100</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">brazil-squareimage-nofill.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">brazil-squareimage-nofill.khvr</span> <span class="pre">width:</span> <span class="pre">20480</span> <span class="pre">height:</span> <span class="pre">20480</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">-7.646484e+00</span> <span class="pre">south:</span> <span class="pre">-9.404297e+00</span> <span class="pre">east:</span> <span class="pre">-5.387695e+01</span> <span class="pre">west:</span> <span class="pre">-5.563477e+01</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">brazil-squareimage-nofill-mask-100feather.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-100.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">on.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">brazil-squareimage-nofill.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.10</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">99</span> <span class="pre">Mem:</span> <span class="pre">975</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:10</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.10</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">brazil-squareimage-nofill-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">brazil-squareimage-nofill-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m16.985s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m14.450s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m2.200s</span></code></p>
<p>The resulting mask file will be approximately 100MB in file size
with a feathered edge 100 pixels from the edge inwards into the
image resource.</p>
<p class="rubric">Resulting mask file from gepolymaskgen seen in the
GIMP photo editing tool:</p>
<p><img alt="gepolymaskgen in gimp photo editor" src="../../images/image31.jpg" /></p>
<p class="rubric">The image resource now has a 100-pixel feather after
Fusion import:</p>
<p><img alt="image with 100-pixel feather in Fusion" src="../../images/image21.jpg" /></p>
<p>Once the mask file is built by <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>, the source
imagery may be imported into Fusion Pro by enabling the
<code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the Fusion GUI or specifying the
<code class="docutils literal notranslate"><span class="pre">--havemask</span></code> option with the <code class="docutils literal notranslate"><span class="pre">genewimageryresource</span></code> or
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span></code> commands.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an image
resource.</p>
<p class="rubric" id="custom-mask-islands">Case 2: Create custom masks for islands</p>
<p>Masking imagery around islands is another good use case for
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> since it is often desirable to only show usable
imagery for the island above sea level and to mask imagery at the
coastlines. In this example, we have imagery for the island of
Oahu for Hawaii, USA, where all imagery for the island is to be
seen in the imagery project but all imagery from the coastline
away from the island to the edge of the imagery is to be masked
from view.</p>
<p class="rubric" id="fusion-preview-window">Fusion Preview window:</p>
<p><img alt="Fusion preview window" src="../../images/image02.jpg" /></p>
<p>The Fusion Preview window above displays the overall dimensions
and source file extents for four images creating an imagery mosaic
for the island of Oahu, Hawaii, USA. A virtual raster description
file (<code class="docutils literal notranslate"><span class="pre">KHVR</span></code>) was created for the four source files and loaded
into the Fusion Preview window.</p>
<p class="rubric">Importing the source imagery into Fusion Pro creates
an image resource with imagery for the island and water
(automask used):</p>
<p><img alt="Island and water automask in Fusion" src="../../images/image11.jpg" /></p>
<p>Four <code class="docutils literal notranslate"><span class="pre">JPEG2000</span></code> images were grouped into one virtual mosaic for
the image resource and a <code class="docutils literal notranslate"><span class="pre">khvr</span></code> mosaic description file was
built with <code class="docutils literal notranslate"><span class="pre">gevirtualraster</span></code>. To create the custom mask we need
to:</p>
<ol class="arabic simple">
<li>Direct <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to use the source <code class="docutils literal notranslate"><span class="pre">khvr</span></code> file as the
base image to set the custom mask the same raster size and
fully masks all imagery from view;</li>
<li>Clip out the island of Oahu with a set of vector polygons so
the island imagery will be visible;</li>
<li>Feather along the specified polygon coastlines to facilitate
smooth blending with other image resources (feather = 100);</li>
<li>Write out the custom mask file.</li>
</ol>
<p>Two examples will be included for this case demonstrating the
effect of positive and negative feather values for feathering
along the shoreline. Generally speaking, a positive feather value
will erode from the mask line inward to show less visible imagery
while a negative feather value will draw away from the mask line
to show more visible imagery.</p>
<p class="rubric" id="island-masks-into-land">Example A: Create a custom edge-matched mask for an
island that masks into the land</p>
<p>The <strong>command template</strong> for creating a custom mask for an island
with a positive value feather is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">imagery.tif</span> <span class="pre">--feather</span> <span class="pre">100</span> <span class="pre">--or_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--output_mask</span> <span class="pre">imagery-mask.tif</span></code></p>
<p>The larger or smaller pixel value may be specified to expand the
mask further from the coastline into the visible imagery (larger
number), or to stay closer to the coastline.</p>
<p>Example console output is included below:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_oahu.khvr</span> <span class="pre">--feather</span> <span class="pre">100</span> <span class="pre">--or_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_oahu-100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_oahu.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_oahu.khvr</span> <span class="pre">width:</span> <span class="pre">10240</span> <span class="pre">height:</span> <span class="pre">10240</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">2.179688e+01</span> <span class="pre">south:</span> <span class="pre">2.091797e+01</span> <span class="pre">east:</span> <span class="pre">-1.575879e+02</span> <span class="pre">west:</span> <span class="pre">-1.584668e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">100</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">OR</span> <span class="pre">mask:</span> <span class="pre">world_coastlines_4326.shp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_oahu-100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_oahu.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">100.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_oahu-100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">world_coastlines_4326</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">glandsat_15m_oahu-100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.38</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">15</span> <span class="pre">Mem:</span> <span class="pre">554</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:03</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.38</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">OR-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_oahu-100mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_oahu-100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m31.757s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m28.390s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m3.020s</span></code></p>
<p>The resulting mask file is approximately 400MB in filesize.
Screenshots of the output mask and resulting Fusion image resource
may be seen below.</p>
<p class="rubric">View of the mask with a 100 pixel feather as seen in
the GIMP photo editor:</p>
<p><img alt="Mask with 100 pixel feather in GIMP" src="../../images/image09.jpg" /></p>
<p class="rubric">View of the Oahu, Hawaii, USA imagery in Fusion
Preview after importing the custom mask with the image
resource:</p>
<p><img alt="Custom" src="../../images/image33.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with the
source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the
Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an image
resource.</p>
<p class="rubric" id="island-masks-into-water">Example B: Create a custom edge-matched mask for an
island that masks into the water</p>
<p>This example uses the same source imagery as <a class="reference internal" href="#island-masks-into-land"><span class="std std-ref">Example
A</span></a> but a negative pixel value is provided for
the feather value to expand the mask feather away from the
shoreline outward into the water.</p>
<p>The <strong>command template</strong> for this example is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">imagery.khvr</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--or_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--output_mask</span> <span class="pre">imagery-mask.tif</span></code></p>
<p>Larger or smaller negative feather values may be specified with
the <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>command to expand farther away from the
coastline mask or closer to the coastline mask as desired.</p>
<p>Example output for creating the mask and screenshots are included
below:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_oahu.khvr</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--or_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_oahu-minus100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_oahu.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_oahu.khvr</span> <span class="pre">width:</span> <span class="pre">10240</span> <span class="pre">height:</span> <span class="pre">10240</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">2.179688e+01</span> <span class="pre">south:</span> <span class="pre">2.091797e+01</span> <span class="pre">east:</span> <span class="pre">-1.575879e+02</span> <span class="pre">west:</span> <span class="pre">-1.584668e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-100</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">OR</span> <span class="pre">mask:</span> <span class="pre">world_coastlines_4326.shp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_oahu-minus100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_oahu.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-100.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_oahu-minus100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">world_coastlines_4326</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">glandsat_15m_oahu-minus100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.38</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">16</span> <span class="pre">Mem:</span> <span class="pre">554</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:03</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.38</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">OR-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_oahu-minus100mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_oahu-minus100mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m31.621s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m28.510s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m3.100s</span></code></p>
<p>The resulting mask file is approximately 400MB in filesize.
Screenshots of the output mask and resulting Fusion image resource
may be seen below.</p>
<p class="rubric">View of the mask file with a -100 pixel feather as
seen in the GIMP photo editor:</p>
<p><img alt="Mask file of Oahu Hawaii in GIMP" src="../../images/image34.jpg" /></p>
<p class="rubric">View of the Oahu, Hawaii, USA imagery in Fusion
Preview after importing the custom mask with the image
resource:</p>
<p><img alt="Oahu Hawaii in Fusion Preview" src="../../images/image28.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with the
source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the
Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an image
resource.</p>
<p class="rubric" id="masks-coastline-shared-edges">Case 3: Create custom masks with coastlines and shared
edges with other imagery resources</p>
<p>Creating custom masks for imagery resources bordering coastlines
is a little more challenging since a set of vector polygons are
needed to mask the desired imagery to the coastline, and it is
necessary to determine what feather values to apply to the
coastline and the external edges of the mask. We will first see the
imagery we will be working with in this example.</p>
<p class="rubric">View from the Fusion Preview GUI with imagery for
California, USA along the coastline:</p>
<p><img alt="Fusiin Preview GUI in California" src="../../images/image41.jpg" /></p>
<p>Forty-two source files of 15-meter imagery have been grouped into
one virtual raster to build a new imagery resource. The source
images along the interior of California fully contain usable
imagery and do not include fill data; however, imagery along the
Pacific Ocean includes water. The goal will be to mask the water
from view while displaying imagery for the land. The workflow will
be as follows:</p>
<ol class="arabic simple">
<li>Create the overall mask for the image</li>
<li>Apply a set of coastal polygons to demarcate the coastline</li>
<li>Feather the coastline and apply the feather to the mask border
as well</li>
<li>Write out the mask file</li>
</ol>
<p>In this case, we will create three different types of masks with
coastline data - one where the coastlines and edges have the same
feathering, one where the coastlines and edges have different
feathering values, and one where the coastline is feathered but
the edges are not feathered.</p>
<p class="rubric" id="coastline-external-edges-same-values">Example A: Create an edge-matched custom mask that
feathers coastlines and external edges with the same feather
value</p>
<p>This example will build a mask file that masks visible imagery to
a specified coastline polygon - described by a source vector file
in <code class="docutils literal notranslate"><span class="pre">ESRI</span> <span class="pre">Shapefile</span> <span class="pre">format</span></code> - and hides all ocean imagery from
view. The source data are comprised of 42 images in a rectangle
with the northernmost and easternmost edges being a border for
another image resource. A consistent feather value (300 pixels)
will be applied to both the coastlines and the external edges of
the imagery with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>.</p>
<p>The <strong>command template</strong> to build this type of mask is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">imagery.khvr</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">-300</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--and_neg_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">imagery-mask.tif</span></code></p>
<p>Here is an example output to build this type of mask for the
15-meter resolution California imagery:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">/opt/google/bin/gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">-300</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--and_neg_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_california_bay_area-coastline-exampleA.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">width:</span> <span class="pre">35840</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.849609e+01</span> <span class="pre">south:</span> <span class="pre">3.585938e+01</span> <span class="pre">east:</span> <span class="pre">-1.211133e+02</span> <span class="pre">west:</span> <span class="pre">-1.241895e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-300</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">world_coastlines_4326.shp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_california_bay_area-coastline-exampleA.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_california_bay_area.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-300.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">on.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_california_bay_area-coastline-exampleA.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">world_coastlines_4326</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">glandsat_15m_california_bay_area-coastline-exampleA.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">19</span> <span class="pre">Mem:</span> <span class="pre">3844</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:28</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_california_bay_area-coastline-exampleA.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_california_bay_area-coastline-exampleA.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">3m55.820s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">3m39.810s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m15.650s</span></code></p>
<p>The resulting mask file is approximately 1GB in filesize.
Screenshot of the mask from the GIMP photo editing tool and the
resulting image resource after the mask is applied are available
below.</p>
<p class="rubric">View of the mask file built in Example A as seen in
the GIMP photo editing tool:</p>
<p><img alt="Example A mask file in GIMP" src="../../images/image13.jpg" /></p>
<p class="rubric">View of the imagery resource within the Fusion Preview
window after the custom mask is imported:</p>
<p><img alt="Finished image after custom mask import" src="../../images/image05.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with the
source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the
Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the havemask mask mode for an image
resource.</p>
<p class="rubric" id="feathered-coastlines-external-edges">Example B: Create an edge-matched custom mask with
feathered coastlines and feathered external edges</p>
<p>This example will build a mask file that masks visible imagery to
a specified coastline polygon - described by a source vector file
in <code class="docutils literal notranslate"><span class="pre">ESRI</span> <span class="pre">Shapefile</span></code> format - and hides all ocean imagery from
view. The source data are comprised of 42 images in a rectangle
with the northernmost and easternmost edges being a border for
another image resource. A feather value of -300 pixels will be
applied to the coastlines while a -100 pixel feather will be
applied to the external imagery edges with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>. This
use case is more complex in that three separate steps are needed
to create twp separate masks - one which includes the feather
border for the overall image, one for the coastlines - and then
one operation to merge the mask files together.</p>
<p>The <strong>command templates</strong> are as follows:</p>
<ol class="arabic">
<li><p class="first"><strong>Create a ‘picture frame’ mask for the overall image:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">source_image.tif</span> <span class="pre">--output_mask</span> <span class="pre">borderfeather-mask.tif</span></code></p>
</li>
<li><p class="first"><strong>Create a coastline mask:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">source_image.tif</span> <span class="pre">--feather</span> <span class="pre">-300</span> <span class="pre">--or_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--output</span> <span class="pre">coastline-mask.tif</span></code></p>
</li>
<li><p class="first"><strong>Merge the two masks together into the final mask:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_mask</span> <span class="pre">coastline-mask.tif</span> <span class="pre">--and_neg_mask</span> <span class="pre">borderfeather-mask.tif</span> <span class="pre">--output_mask</span> <span class="pre">source_image-mask.tif</span></code></p>
</li>
</ol>
<p>Screen shots of each mask file generated by the three steps are
included below as a reference.</p>
<p class="rubric">Picture frame border mask:</p>
<p><img alt="picture frame border mask" src="../../images/image30.jpg" /></p>
<p class="rubric">Coastline mask:</p>
<p><img alt="Example A mask file in GIMP" src="../../images/image13.jpg" /></p>
<p class="rubric">Finished, merged mask of coastline and border feather:</p>
<p><img alt="finished mask of coastline and border feather" src="../../images/image07.jpg" /></p>
<p>Console output for building these masks are included below for
reference along with the time to build and output file sizes for
each of the three masks.</p>
<ol class="arabic">
<li><p class="first"><strong>Create a ‘picture frame’ mask for the overall image:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">--output_mask</span> <span class="pre">california_borderfeather-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-100</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">width:</span> <span class="pre">35840</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.849609e+01</span> <span class="pre">south:</span> <span class="pre">3.585938e+01</span> <span class="pre">east:</span> <span class="pre">-1.211133e+02</span> <span class="pre">west:</span> <span class="pre">-1.241895e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">california_borderfeather-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-100.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">on.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_california_bay_area.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">98</span> <span class="pre">Mem:</span> <span class="pre">2294</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:27</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">california_borderfeather-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">california_borderfeather-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m40.672s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m36.000s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m4.300s</span></code></p>
<p>The resulting mask file is approximately 1 GB in file size.</p>
</li>
<li><p class="first"><strong>Create a coastline mask:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">--feather</span> <span class="pre">-300</span> <span class="pre">--or_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--output</span> <span class="pre">california_coastline-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">width:</span> <span class="pre">35840</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.849609e+01</span> <span class="pre">south:</span> <span class="pre">3.585938e+01</span> <span class="pre">east:</span> <span class="pre">-1.211133e+02</span> <span class="pre">west:</span> <span class="pre">-1.241895e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-300</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">OR</span> <span class="pre">mask:</span> <span class="pre">world_coastlines_4326.shp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">california_coastline-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_california_bay_area.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-300.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">california_coastline-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">world_coastlines_4326</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">california_coastline-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">19</span> <span class="pre">Mem:</span> <span class="pre">3844</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:28</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">OR-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">california_coastline-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">california_coastline-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">3m56.730s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">3m41.010s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m15.340s</span></code></p>
<p>The resulting mask file is approximately 1 GB in file size.</p>
</li>
<li><p class="first"><strong>Merge the two masks together into the final mask:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--base_mask</span> <span class="pre">california_coastline-mask.tif</span> <span class="pre">--and_neg_mask</span> <span class="pre">california_borderfeather-mask.tif</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">mask:</span> <span class="pre">california_coastline-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">california_coastline-mask.tif</span> <span class="pre">width:</span> <span class="pre">35840</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.849609e+01</span> <span class="pre">south:</span> <span class="pre">3.585938e+01</span> <span class="pre">east:</span> <span class="pre">-1.211133e+02</span> <span class="pre">west:</span> <span class="pre">-1.241895e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">GTiff/GeoTIFF</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">california_borderfeather-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">mask</span> <span class="pre">california_coastline-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m23.029s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m15.690s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m7.300s</span></code></p>
<p>The resulting mask file is approximately 1 GB in file size.</p>
<p class="rubric">View of finished mask file feathering the
coastlines and external edges of the image resource:</p>
<p><img alt="finished mask of coastline and border feather" src="../../images/image07.jpg" /></p>
<p class="rubric">View of finished image resource after importing
custom mask:</p>
<p><img alt="Finished image after custom mask import" src="../../images/image05.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with
the source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in
the Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command
line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an
image resource.</p>
</li>
</ol>
<p class="rubric" id="feathered-internal-coastline-no-edge">Example C: Feathered internal coastline and no-feather
external edge</p>
<p>This example will build a mask file that masks visible imagery to
a specified coastline polygon - described by a source vector file
in <code class="docutils literal notranslate"><span class="pre">ESRI</span> <span class="pre">Shapefile</span></code> format - and hides all ocean imagery from
view. The source data are comprised of 42 images in a rectangle
with the northernmost and easternmost edges being a border for
another image resource. A feather value (300 pixels) will be
applied to the coastlines while the external imagery edges will
have a zero-feather edge.</p>
<p>The <strong>command template</strong> for this mask is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">source_imagery.tif</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">-300</span> <span class="pre">--feather_border</span> <span class="pre">0</span> <span class="pre">--and_neg_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">source_imagery-mask.tif</span></code></p>
<p>Console output for building this mask is included below for
reference:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">-300</span> <span class="pre">--feather_border</span> <span class="pre">0</span> <span class="pre">--and_neg_mask</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span> <span class="pre">width:</span> <span class="pre">35840</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.849609e+01</span> <span class="pre">south:</span> <span class="pre">3.585938e+01</span> <span class="pre">east:</span> <span class="pre">-1.211133e+02</span> <span class="pre">west:</span> <span class="pre">-1.241895e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-300</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">0</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">world_coastlines_4326.shp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_california_bay_area.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-300.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">off.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">world_coastlines_4326</span> <span class="pre">world_coastlines_4326.shp</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">19</span> <span class="pre">Mem:</span> <span class="pre">3844</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:28</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_california_bay_area-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">3m55.201s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">3m40.410s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m14.540s</span></code></p>
<p>The resulting mask will be approximately 1 GB in file size.</p>
<p class="rubric">View of the finished mask within the GIMP photo
editing tool:</p>
<p><img alt="finished mask in GIMP" src="../../images/image32.jpg" /></p>
<p class="rubric">View of the imagery resource within the Fusion Preview
window after importing the custom mask:</p>
<p><img alt="Fusion preview window with custom mark import" src="../../images/image43.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with the
source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the
Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an image
resource.</p>
<p class="rubric" id="masking-out-sections-large-image">Case 4: Masking out sections within an image resource</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is capable of masking out sections within a
source image in addition to masking external edges of the imagery.
This is similar to the hole checking option with the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>
tool which can automatically scan an image resource to seek fill
data within the image resource. The main difference is
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> will only mask out user-specified sections of
the imagery. This example case will build on the principles
discussed in <a class="reference internal" href="#imagery-no-fill-pixels"><span class="std std-ref">Case 1</span></a> where a fixed feather
value edge mask will be made for a mosaic with imagery to the
edges, and additionally demonstrate removing (masking) internal
portions of an image resource from view with a <code class="docutils literal notranslate"><span class="pre">KML</span></code> file
created in Google Earth. Let’s first see a screenshot of imagery
used for this example.</p>
<p class="rubric" id="view-of-image-resource-in-fusion-preview-after-import-with-the-automask-tool">View of image resource in Fusion Preview after import
with the automask tool:</p>
<p><img alt="image in Fusion with automask" src="../../images/image16.jpg" /></p>
<p>Boundaries for the imported source files (<code class="docutils literal notranslate"><span class="pre">khvr</span></code>) are overlaid
on the image for reference.</p>
<p>The workflow for this example is different from the others since
we need a <code class="docutils literal notranslate"><span class="pre">KML</span></code> file to specify which area in the image to
remove from view. The general workflow will be:</p>
<ol class="arabic simple">
<li>Import the imagery into GEE Fusion Pro and build into an
imagery project.</li>
<li>Build and publish the imagery into a flyable 3D database.</li>
<li>View the 3D database with Google Earth EC to QA the data.</li>
<li>Draw an enclosed polygon in Google Earth EC that would mask the
missing area of imagery from view.</li>
<li>Build the custom mask with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> to correctly
feather the imagery edges and mask the missing imagery.</li>
<li>Import the custom mask with the image resource.</li>
</ol>
<p>Examples of what the imagery resource looks like as viewed in
Google Earth EC are included below.</p>
<p class="rubric">This image demonstrates how the image resource appears
with the area of missing imagery:</p>
<p><img alt="Missing imagery in GEEC" src="../../images/image23.jpg" /></p>
<p class="rubric">This image is a screenshot after a polygon was drawn
over the entire area of missing imagery:</p>
<p><img alt="Polygon on mising imagery" src="../../images/image03.jpg" /></p>
<p>The polygon area was set to 50% opacity in order to show the
polygon fully covers the area of missing imagery with a little
overlap into the usable imagery. This polygon will be stored in
the <strong>Places</strong> panel of Google Earth EC and must be saved out from
Google Earth as an independent <code class="docutils literal notranslate"><span class="pre">KML</span></code> file that can then be
utilized with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Additional information about creating polygons within
Google Earth is also freely available with the Google Earth
Outreach tutorials, directly accessible at
<a class="reference external" href="http://earth.google.com/outreach/tutorial_annotate.html#addpolygons">http://earth.google.com/outreach/tutorial_annotate.html#addpolygons</a>.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Each polygon correction should be saved out as a
<code class="docutils literal notranslate"><span class="pre">KML</span></code> file directly (four polygons saved to four separate
<code class="docutils literal notranslate"><span class="pre">KML</span></code> files) as these will be separate mask operations within
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>.</p>
</div>
<p class="rubric" id="feathered-edge-masking-missing-internal-imagery-one-step">Example A: Creating an edge-matched mask with a
feathered edge and masking missing internal imagery in one step</p>
<p>This example will create the custom mask in one command sequence
by first creating a feathered edge mask based on the source image
(<code class="docutils literal notranslate"><span class="pre">--base_image</span></code>) and then applying a <code class="docutils literal notranslate"><span class="pre">KML</span></code> file to mask out
the area of missing imagery.</p>
<p>The <strong>command template</strong> to create the mask, in one step, is:</p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">source_imagery.khvr</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">50</span> <span class="pre">--and_neg_mask</span> <span class="pre">missing-imagery-area.kml</span> <span class="pre">--output_mask</span> <span class="pre">source_imagery-mask.tif</span></code></p>
<p>Console output for creating the mask file in one step is as
follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">50</span> <span class="pre">--and_neg_mask</span> <span class="pre">bhutan.kml</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-100</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr</span> <span class="pre">width:</span> <span class="pre">30720</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">2.882812e+01</span> <span class="pre">south:</span> <span class="pre">2.619141e+01</span> <span class="pre">east:</span> <span class="pre">9.114258e+01</span> <span class="pre">west:</span> <span class="pre">8.850586e+01</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">50</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">bhutan.kml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-100.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">on.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">99</span> <span class="pre">Mem:</span> <span class="pre">1990</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:23</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">50.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">ogr2ogr</span> <span class="pre">-t_srs</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span> <span class="pre">/tmp/p14999QFR8Mx/tmp.shp</span> <span class="pre">bhutan.kml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Warning</span> <span class="pre">6:</span> <span class="pre">Normalized/laundered</span> <span class="pre">field</span> <span class="pre">name:</span> <span class="pre">'Description'</span> <span class="pre">to</span> <span class="pre">'Descriptio'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">tmp</span> <span class="pre">/tmp/p14999QFR8Mx/tmp.shp</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">93</span> <span class="pre">Mem:</span> <span class="pre">3262</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:23</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">1m24.041s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">1m11.650s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m11.990s</span></code></p>
<p>The resulting mask file will be approximately 900 MB in file size.
Screenshots of the finished mask and the resulting image resource
are included below.</p>
<p class="rubric">Custom mask which masks missing interior imagery with
feathered edge as viewed in the GIMP photo editing tool:</p>
<p><img alt="Custom mask with missing imagery in GIMP" src="../../images/image08.jpg" /></p>
<p class="rubric">Resulting image resource built by Fusion after the
custom mask is imported. Lower resolution imagery from the
resource under the 15-meter imagery will be visible from the
internal area masked from view:</p>
<p><img alt="Image in Fusion after custom mask import" src="../../images/image22.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with the
source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in the
Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an image
resource.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This mask file could also be created in two steps as
well - the first step to create the base mask file (<strong>picture
frame</strong>) that provides a feathered edge for the overall image,
and the second step to apply the internal mask with the
specified <code class="docutils literal notranslate"><span class="pre">KML</span></code> file. Multiple areas may be removed from the
internal portion of the image mask as separate operations.</p>
</div>
<p class="rubric" id="feathered-edge-masking-missing-internal-imagery-two-step">Example B: Creating an edge-matched mask with a
feathered edge and masking missing internal imagery in two
steps</p>
<p>This example will create the custom mask in two command sequences:
in the first step a feathered edge mask based on the source
image (<code class="docutils literal notranslate"><span class="pre">--base_image</span></code>) is built; and in the second step, a
<code class="docutils literal notranslate"><span class="pre">KML</span></code> file to mask out the area of missing imagery is applied to
the mask built in the first step.</p>
<p>The <strong>command templates</strong> to create the mask are:</p>
<ol class="arabic">
<li><p class="first"><strong>Create the edge mask (picture frame):</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">source_imagery.khvr</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">source_imagery-basemask.tif</span></code></p>
</li>
<li><p class="first"><strong>Mask the area of missing imagery from the mask built in the
previous step:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_mask</span> <span class="pre">source_imagery-basemask.tif</span> <span class="pre">--feather</span> <span class="pre">50</span> <span class="pre">--and_neg_mask</span> <span class="pre">missing-imagery-area.kml</span> <span class="pre">--output_mask</span> <span class="pre">source_imagery-mask.tif</span></code></p>
</li>
</ol>
<p>Console output for creating the mask file in one step is as
follows:</p>
<ol class="arabic">
<li><p class="first"><strong>Create the edge mask (picture frame):</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--feather</span> <span class="pre">-100</span> <span class="pre">--feather_border</span> <span class="pre">1</span> <span class="pre">--base_image</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-100</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr</span> <span class="pre">width:</span> <span class="pre">30720</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">2.882812e+01</span> <span class="pre">south:</span> <span class="pre">2.619141e+01</span> <span class="pre">east:</span> <span class="pre">9.114258e+01</span> <span class="pre">west:</span> <span class="pre">8.850586e+01</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-100.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">border</span> <span class="pre">is</span> <span class="pre">on.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">glandsat_15m_bhutan_missing_imagery.khvr.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">97</span> <span class="pre">Mem:</span> <span class="pre">1990</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:23</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m36.297s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m32.370s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m3.620s</span></code></p>
<p>The resulting mask will be approximately 900 MB in filesize.</p>
<p class="rubric" id="gepolymaskgen-viewed-gimp">Edge mask created with gepolymaskgen as viewed in
the GIMP photo editing tool:</p>
<p><img alt="gepolymaskgen Edge mask in GIMP" src="../../images/image06.jpg" /></p>
</li>
<li><p class="first"><strong>Mask the area of missing imagery from the mask built in the
previous step:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gepolymaskgen</span> <span class="pre">--base_mask</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif</span> <span class="pre">--feather</span> <span class="pre">50</span> <span class="pre">--and_neg_mask</span> <span class="pre">bhutan.kml</span> <span class="pre">--output_mask</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif</span> <span class="pre">width:</span> <span class="pre">30720</span> <span class="pre">height:</span> <span class="pre">30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">2.882812e+01</span> <span class="pre">south:</span> <span class="pre">2.619141e+01</span> <span class="pre">east:</span> <span class="pre">9.114258e+01</span> <span class="pre">west:</span> <span class="pre">8.850586e+01</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">GTiff/GeoTIFF</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">50</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">bhutan.kml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">mask</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-basemask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">50.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">ogr2ogr</span> <span class="pre">-t_srs</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span> <span class="pre">/tmp/p15693nKOdrD/tmp.shp</span> <span class="pre">bhutan.kml</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Warning</span> <span class="pre">6:</span> <span class="pre">Normalized/laundered</span> <span class="pre">field</span> <span class="pre">name:</span> <span class="pre">'Description'</span> <span class="pre">to</span> <span class="pre">'Descriptio'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">tmp</span> <span class="pre">/tmp/p15693nKOdrD/tmp.shp</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.04</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">90</span> <span class="pre">Mem:</span> <span class="pre">3228</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:23</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.04</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">glandsat_15m_bhutan_missing_imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">real</span> <span class="pre">0m56.214s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">0m44.330s</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sys</span> <span class="pre">0m11.890s</span></code></p>
<p>The resulting mask file will be approximately 900 MB in
filesize.</p>
<p class="rubric">Merged mask built with gepolymaskgen with feathered
edge and internal image masking for area of missing imagery
as viewed in the GIMP photo editing tool:</p>
<p><img alt="gepolymaskgen merged mask in GIMP" src="../../images/image08.jpg" /></p>
<p>The custom mask file may now be imported into Fusion Pro with
the source imagery by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode in
the Fusion Pro Resource Editor or by specifying the
<code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span></code> option on the command
line.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further
information about enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for an
image resource.</p>
</li>
</ol>
<p class="rubric" id="custom-masks-gemaskgen-gepolymaskgen">Case 5: Building custom masks with both gemaskgen and
gepolymaskgen</p>
<p>There are special cases where the capabilities of both
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> and <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> are needed to build a custom
mask file for an image resource. The SFBayAreaLansat imagery from
the Google Earth Enterprise Fusion Pro Tutorial is a good example
(screenshot below).</p>
<p class="rubric">Screenshot of the usgsLanSat.tif source file imported
into Fusion Pro viewed with no mask. Note the areas of fill
data surrounding the imagery:</p>
<p><img alt="usgsLanSat.tif in Fusion pro with no mask" src="../../images/image19.jpg" /></p>
<p class="rubric">Screenshot of the usgsLanSat.tif imagery after being
imported into Fusion Pro with a mask automatically computed:</p>
<p><img alt="usgsLanSat.tif in Fusion pro with a mask" src="../../images/image15.jpg" /></p>
<p class="rubric">Screenshot of the imported SFBayAreaLanSat image
resource in Fusion after the custom mask is created:</p>
<p><img alt="SFBayAreaLanSat image in fusion with custom mask" src="../../images/image12.jpg" /></p>
<p>Here, the Fusion Pro automask function is needed to build a mask
for the source imagery to mask all Fill Data; however, the imagery
also includes imagery for the water which should be, ideally,
masked to the coastline. Both <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> and <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>
will be needed to accomplish this type of masking to
build a mask hiding fill data within the image and then creating a
coastline mask. This example is a special case since the source
imagery must be imported into Fusion format first, then the custom
mask will be generated from the output of the imagery resource
build process. This example will also utilize information found in
Appendixes <a class="reference internal" href="#locating-mask-files-format-data-asset-root"><span class="std std-ref">B</span></a>, <a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">C</span></a> and
<a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">D</span></a> for locating masks built with
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>.</p>
<p>The workflow to accomplish this custom mask will be:</p>
<ol class="arabic simple">
<li>Import the source imagery as a Fusion Pro image resource</li>
<li>Use the mask file built during the image resource import as the
base mask for <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code></li>
<li>Mask the imagery to the coastline and write out the new mask</li>
<li>Enable the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask mode for the image resource to
import the custom mask</li>
</ol>
<p>The <strong>command templates</strong> for building this custom mask will be:</p>
<ol class="arabic">
<li><p class="first"><strong>Locate the mask computed during the image resource build:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gequery --outfiles
Resources/Imagery/YourImageResource.kiasset/maskgen.kia
/gevol/assets/Resources/Imagery/YourImageResource.kiasset/maskgen.kia/ver001/mask.tif
</pre></div>
</div>
</li>
<li><p class="first"><strong>Create an inverted version of the mask:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol/assets/Resources/Imagery/YourImageResource.kiasset/maskgen.kia/ver001/mask.tif</span> <span class="pre">--invert</span> <span class="pre">--output_mask</span> <span class="pre">/gevol/src/path/to/source/imagery-basemaskinverted.tif</span></code></p>
</li>
<li><p class="first"><strong>Create a coastline mask using the mask as a base image:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol/src/path/to/source/imagery-basemaskinverted.tif</span> <span class="pre">--invert</span> <span class="pre">--feather</span> <span class="pre">100</span> <span class="pre">--and_neg_mask</span> <span class="pre">/gevol/src/coastlines.shp</span> <span class="pre">--output_mask</span> <span class="pre">/gevol/src/path/to/source/imagery-coastlinesinverted.tif</span></code></p>
</li>
<li><p class="first"><strong>Merge the two mask files to the final custom mask:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_mask</span> <span class="pre">/gevol/src/path/to/source/imagery-basemaskinverted.tif</span> <span class="pre">--invert</span> <span class="pre">--and_neg_mask</span> <span class="pre">/gevol/src/path/to/source/imagery-coastlinesinverted.tif</span> <span class="pre">--output_mask</span> <span class="pre">/gevol/src/path/to/source/imagery-mask.tif</span></code></p>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">imagery-mask.tif</span></code> custom mask may then be
imported with the source imagery and applied to the image
resource in Google Earth Enterprise Fusion Pro.</p>
</li>
</ol>
<p>An example workflow is included below which constructs a custom
mask - masking both fill data automatically with <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> and
the coastlines with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> - for the SFBayAreaLanSat
imagery resource built during the Google Earth Enterprise Fusion
Tutorial.</p>
<ol class="arabic">
<li><p class="first"><strong>Locate the computed mask file built when SFBayAreaLanSat
built by gemaskgen</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">gequery</span> <span class="pre">--infiles</span> <span class="pre">Resources/Imagery/SFBayAreaLanSat.kiasset/maskproduct.kia</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/product.kia/ver001/raster.kip</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif</span></code></p>
</li>
<li><p class="first"><strong>Create a custom mask with gepolymaskgen using the gemaskgen base
mask and mask to the coastlines (three steps)</strong></p>
<ol class="loweralpha simple">
<li>Invert the mask file built during the Fusion Pro import:</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">sudo</span></code><strong>``/opt/google/bin/gepolymaskgen –base_mask /gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif –invert –output_mask /opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif``</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">mask:</span> <span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif</span> <span class="pre">width:</span> <span class="pre">8206</span> <span class="pre">height:</span> <span class="pre">5856</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.846468e+01</span> <span class="pre">south:</span> <span class="pre">3.645418e+01</span> <span class="pre">east:</span> <span class="pre">-1.207133e+02</span> <span class="pre">west:</span> <span class="pre">-1.235306e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">GTiff/GeoTIFF</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">mask</span> <span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif</span></code></p>
<ol class="loweralpha simple" start="2">
<li>Create a second mask file with the coastlines, inverted:</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">sudo</span></code><strong>``/opt/google/bin/gepolymaskgen –base_image /gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif –invert –feather 50 –and_neg_mask /gevol-local/src/gepolymaskgen-howto/world_coastlines_4326.shp –output_mask /opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif``</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">image:</span> <span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif</span> <span class="pre">width:</span> <span class="pre">8206</span> <span class="pre">height:</span> <span class="pre">5856</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.846468e+01</span> <span class="pre">south:</span> <span class="pre">3.645418e+01</span> <span class="pre">east:</span> <span class="pre">-1.207133e+02</span> <span class="pre">west:</span> <span class="pre">-1.235306e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">GTiff/GeoTIFF</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Feather</span> <span class="pre">-50</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">/gevol-local/src/gepolymaskgen-howto/world_coastlines_4326.shp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">image</span> <span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">feather</span> <span class="pre">-50.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Executing:</span> <span class="pre">gdal_rasterize</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-burn</span> <span class="pre">255</span> <span class="pre">-l</span> <span class="pre">world_coastlines_4326</span> <span class="pre">/gevol-local/src/gepolymaskgen-howto/world_coastlines_4326.shp</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">0...10...20...30...40...50...60...70...80...90...100</span> <span class="pre">-</span> <span class="pre">done.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">tiles</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Completed</span> <span class="pre">100%</span> <span class="pre">(1/1)</span> <span class="pre">-</span> <span class="pre">tiles/sec:</span> <span class="pre">0.83</span> <span class="pre">-</span> <span class="pre">time</span> <span class="pre">left:</span> <span class="pre">00:00:00</span> <span class="pre">[CPU:</span> <span class="pre">7</span> <span class="pre">Mem:</span> <span class="pre">292</span> <span class="pre">MB</span> <span class="pre">PF:</span> <span class="pre">0]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Processed</span> <span class="pre">1</span> <span class="pre">tiles</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">time</span> <span class="pre">to</span> <span class="pre">process:</span> <span class="pre">00:00:01</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Average</span> <span class="pre">tiles</span> <span class="pre">per</span> <span class="pre">second:</span> <span class="pre">0.83</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif</span></code></p>
<ol class="loweralpha simple" start="3">
<li>Construct the final mask by merging the two mask files:</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">sudo</span></code><strong>``/opt/google/bin/gepolymaskgen –base_mask /opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif –invert –and_neg_mask /opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif –output_mask /opt/google/share/tutorials/fusion/Imagery/usgsLanSat-mask.tif``</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Base</span> <span class="pre">mask:</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif</span> <span class="pre">width:</span> <span class="pre">8206</span> <span class="pre">height:</span> <span class="pre">5856</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">north:</span> <span class="pre">3.846468e+01</span> <span class="pre">south:</span> <span class="pre">3.645418e+01</span> <span class="pre">east:</span> <span class="pre">-1.207133e+02</span> <span class="pre">west:</span> <span class="pre">-1.235306e+02</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">File</span> <span class="pre">type:</span> <span class="pre">GTiff/GeoTIFF</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Projection</span> <span class="pre">:</span> <span class="pre">'GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]'</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Invert</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND</span> <span class="pre">mask:</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertcoastmask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Output</span> <span class="pre">mask:</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Setting</span> <span class="pre">base</span> <span class="pre">mask</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-invertbasemask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Inverting</span> <span class="pre">current</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">AND-ing</span> <span class="pre">mask</span> <span class="pre">with</span> <span class="pre">new</span> <span class="pre">mask.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Saving</span> <span class="pre">mask</span> <span class="pre">to</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-mask.tif.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Fusion</span> <span class="pre">Notice:</span> <span class="pre">Writing</span> <span class="pre">alpha</span> <span class="pre">file</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-mask.tif</span></code></p>
</li>
</ol>
<p>Screenshots of the mask files during the build process are
included below for reference. Each mask file is approximately 50 MB
in file size.</p>
<p class="rubric">Mask computed by gemaskgen during SFBayAreaLanSat
image resource import:</p>
<p><img alt="mask by gemaskgen during SFBayAreaLanSat import" src="../../images/image18.jpg" /></p>
<p class="rubric">Step A: Inverted base mask:</p>
<p><img alt="Inverted base mask" src="../../images/image25.jpg" /></p>
<p class="rubric">Step B: Inverted coastlines mask:</p>
<p><img alt="Inverted coastlines mask" src="../../images/image20.jpg" /></p>
<p class="rubric">Step C: Merged, finished custom mask:</p>
<p><img alt="merged custom mask" src="../../images/image01.jpg" /></p>
<p>The custom mask may now be imported into Google Earth Enterprise
Fusion Pro with the image resource by enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code>
mask mode.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a> for further details
about importing the new custom mask with an image resource.</p>
<p class="rubric">A screenshot of the SFBayAreaLanSat image resource
with the custom mask is viewable below:</p>
<p><img alt="SFBayAreaLanSat image with custom mask" src="../../images/image12.jpg" /></p>
<p>This example workflow utilized the mask file automatically
computed by Fusion Pro during the image resource import. By
default, the mask files created by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> will typically be
low resolution with a maximum of 16,000 pixels on any one side. It
is possible to create a higher resolution mask file by manually
operating the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> command on the command line.</p>
<p>Please see <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix D</span></a> for further details.</p>
<p class="rubric" id="importing-custom-masks-imagery-terrain-gee-fusion">Appendix A: Importing custom masks with imagery and
terrain resources in Google Earth Enterprise Fusion Pro</p>
<p>Custom imagery mask files built by either <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>,
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>, or another third-party application will only be
imported automatically if the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mask option is selected
for an image or terrain resource. Custom masks may be created
before an image is imported into Fusion Pro or built after the
image has already been imported as a resource. For either case,
the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> masking mode may be enabled either from the
Fusion GUI Resource Editor or from the command line with the
<code class="docutils literal notranslate"><span class="pre">--havemask</span></code>option.</p>
<p>Example procedures for enabling the <code class="docutils literal notranslate"><span class="pre">havemask</span></code> option by command
line and the Fusion GUI are available below as reference. Further
details about the Fusion GUI Resource Editor and the command line
tools <code class="docutils literal notranslate"><span class="pre">genewimageryresource</span></code> and <code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span></code> may
be found in the “Google Earth Enterprise Fusion Reference Guide”
<strong>Defining Resources</strong> section and the <strong>Command Line Reference</strong>
section.</p>
<p>Four examples cases are included below as a reference - two for
enabling <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mode within the Fusion GUI for new or
existing image resources, and two for enabling <code class="docutils literal notranslate"><span class="pre">havemask</span></code> mode
on the command line.</p>
<p class="rubric" id="enable-havemask-new-image-resource">Example 1: Enable havemask mode in the Fusion GUI for
a new image resource</p>
<ol class="arabic">
<li><p class="first">Move the custom mask file to the same folder as the source file
for the image.</p>
</li>
<li><p class="first">Rename the custom mask file to be the same file name as the
source image file with a <code class="docutils literal notranslate"><span class="pre">-mask.tif</span></code> extension.</p>
<p>For example, if the <code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example.tif</span></code> is the
source file, then the custom mask must be:</p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example-mask.tif</span></code></p>
</li>
<li><p class="first">Load the Fusion GUI Asset Manager:</p>
<p><img alt="Fusion GUI Asset Manager" src="../../images/image14.jpg" /></p>
</li>
<li><p class="first">Start a new image resource and specify the source file,
provider, and acquisition date.</p>
</li>
<li><p class="first">Set the <strong>Mask Type</strong> to Have Mask from the <strong>Mask Options</strong> drop-down
menu.</p>
<p><img alt="Mask Options drop down menu" src="../../images/image17.jpg" /></p>
</li>
<li><p class="first">Save the image resource, specifying the location and name for
the new image resource.</p>
</li>
<li><p class="first">Build the image resource.</p>
</li>
<li><p class="first">Once complete, load the newly built Fusion image resource into
the Preview window to view the results. Proceed building the
image resource into an imagery project if the custom mask is
satisfactory, or continue working on the custom mask and repeat
the import process until satisfied with the custom mask.</p>
</li>
</ol>
<p class="rubric" id="enable-havemask-command-line-new-image-resource">Example 2: Enable havemask mode by command line for a
new image resource</p>
<ol class="arabic">
<li><p class="first">Move the custom mask file to the same folder as the source file
for the image.</p>
</li>
<li><p class="first">Rename the custom mask file to be the same file name as the
source image file with a <code class="docutils literal notranslate"><span class="pre">-mask.tif</span></code> extension.</p>
<p>For example, if the <code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example.tif</span></code> is the
source file, then the custom mask must be:</p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example-mask.tif</span></code></p>
</li>
<li><p class="first">On the command line, enter:</p>
<p><code class="docutils literal notranslate"><span class="pre">genewimageryresource</span> <span class="pre">--havemask</span> <span class="pre">--sourcedate</span> <span class="pre">'0000-00-00'</span> <span class="pre">--provider</span> <span class="pre">'USGS'</span> <span class="pre">-o</span> <span class="pre">Resources/Imagery/Example-Imagery</span> <span class="pre">/gevol/src/imagery/example.tif</span></code></p>
<p>replacing the provider, sourcedate and resource name to suit
the imagery being imported.</p>
</li>
<li><p class="first">Build the image resource by entering:</p>
<p><code class="docutils literal notranslate"><span class="pre">gebuild</span> <span class="pre">Resources/Imagery/Example-Imagery</span></code>on the command
line.</p>
</li>
<li><p class="first">Once the image resource build is complete, load the newly built
Fusion image resource into the Preview window to view the
results. Proceed building the image resource into an imagery
project if the custom mask is satisfactory, or continue working
on the custom mask and repeat the import process until
satisfied with the custom mask.</p>
</li>
</ol>
<p class="rubric" id="enable-havemask-existing-image-resource">Example 3: Enable havemask mode in the Fusion GUI for
an existing image resource</p>
<ol class="arabic">
<li><p class="first">Move the custom mask file to the same folder as the source file
for the image.</p>
</li>
<li><p class="first">Rename the custom mask file to be the same file name as the
source image file with a <code class="docutils literal notranslate"><span class="pre">-mask.tif</span></code> extension.</p>
<p>For example, if the <code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example.tif</span></code> is the source
file, then the custom mask must be:</p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example-mask.tif</span></code></p>
</li>
<li><p class="first">Load the Fusion GUI Asset Manager:</p>
<p><img alt="Fusion GUI Asset Manager" src="../../images/image14.jpg" /></p>
</li>
<li><p class="first">Double-click the image resource to which the
custom mask will be applied, or right-click the image.
resource and select <strong>Modify</strong></p>
</li>
<li><p class="first">When the Resource Editor loads, change the <strong>Mask Type</strong> to Have
Mask from the <strong>Mask Options</strong> drop-down menu.</p>
<p><img alt="Mask Options drop down menu" src="../../images/image17.jpg" /></p>
</li>
<li><p class="first">Save the image resource.</p>
</li>
<li><p class="first">Build the image resource.</p>
</li>
<li><p class="first">Once the image resource build is complete, load the newly built
Fusion image resource into the Preview window to view the
results. Proceed building the image resource into an imagery
project if the custom mask is satisfactory, or continue working
on the custom mask and repeat the import process until
satisfied with the custom mask.</p>
</li>
</ol>
<p class="rubric" id="enable-havemask-command-line-existing-image-resource">Example 4: Enable havemask mode by command line for an
existing image resource</p>
<ol class="arabic">
<li><p class="first">Move the custom mask file to the same folder as the source file
for the image.</p>
</li>
<li><p class="first">Rename the custom mask file to be the same file name as the
source image file with a <code class="docutils literal notranslate"><span class="pre">-mask.tif</span></code> extension.</p>
<p>For example, if the <code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example.tif</span></code> is the source
file, then the custom mask must be:</p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol/src/imagery/example-mask.tif</span></code></p>
</li>
<li><p class="first">On the command line, enter:</p>
<p><code class="docutils literal notranslate"><span class="pre">gemodifyimageryresource</span> <span class="pre">--havemask</span> <span class="pre">--sourcedate</span> <span class="pre">'0000-00-00'</span> <span class="pre">--provider</span> <span class="pre">'USGS'</span> <span class="pre">-o</span> <span class="pre">Resources/Imagery/Example-Imagery</span> <span class="pre">/gevol/src/imagery/example.tif</span></code></p>
<p>replacing the provider, sourcedate and resource name to suit
the imagery being imported.</p>
</li>
<li><p class="first">Build the image resource by entering
<code class="docutils literal notranslate"><span class="pre">gebuild</span> <span class="pre">Resources/Imagery/Example-Imagery</span></code>on the command
line.</p>
</li>
<li><p class="first">Once the image resource build is complete, load the newly built
Fusion image resource into the Preview window to view the
results. Proceed building the image resource into an imagery
project if the custom mask is satisfactory, or continue working
on the custom mask and repeat the import process until
satisfied with the custom mask.</p>
</li>
</ol>
<p class="rubric" id="locating-mask-files-format-data-asset-root">Appendix B: Locating mask files and Fusion format data
in an Asset Root</p>
<p>Several files are created by GEE Fusion Pro when building an
imagery or terrain resource, including the Fusion-format version
of the imagery (<code class="docutils literal notranslate"><span class="pre">.kip</span></code> extension) or terrain (<code class="docutils literal notranslate"><span class="pre">.ktp</span></code>
extension), a computed mask file built by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>, and the
Fusion-format version of the computed mask (<code class="docutils literal notranslate"><span class="pre">.kmp</span></code> extension).
These files and folders may be located within the Asset Root with
the help of the <code class="docutils literal notranslate"><span class="pre">gequery</span></code> command and the <code class="docutils literal notranslate"><span class="pre">--outfiles</span></code> and
<code class="docutils literal notranslate"><span class="pre">--infiles</span></code> options.</p>
<p>These files may be desired for custom masking operations such as
computing a new, higher-resolution mask with <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> - which
is computed from a <code class="docutils literal notranslate"><span class="pre">.kip</span></code> or <code class="docutils literal notranslate"><span class="pre">.ktp</span></code> folder - or locating the
mask automatically built with <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> to add coastlines,
such as described in the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5 Example</span></a>
section. This section of the How-To guide will provide command
templates for locating the Fusion-format versions of imagery and
terrain within the GEE Fusion Asset Root, and locating a mask file
built by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> during resource import.</p>
<p class="rubric" id="locate-fusion-format-imagery-mask-files-image-resource">Example 1: Locate the Fusion format imagery (.kip) and
mask (.kmp) files of an image resource</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span></code> command can be used to locate the
Fusion-format versions of imported imagery or terrain data, and
the Fusion-format version of the mask file as these are the
<strong>output</strong> of the Fusion resource. Here is an example command to
find the Fusion format imagery (<code class="docutils literal notranslate"><span class="pre">.kip</span></code>) and mask (<code class="docutils literal notranslate"><span class="pre">.kmp</span></code>)
files from the SFBayAreaLanSat image resource built during the
Fusion Pro Tutorial:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">gequery</span> <span class="pre">--outfiles</span> <span class="pre">Resources/Imagery/SFBayAreaLanSat.kiasset</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/product.kia/ver001/raster.kip</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskproduct.kia/ver002/mask.kmp</span></code></p>
<p>The response from <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span></code> provides the full folder
path where the <code class="docutils literal notranslate"><span class="pre">.kip</span></code> and <code class="docutils literal notranslate"><span class="pre">.kmp</span></code> folders are located that
comprise the SFBayAreaLanSat image resource imagery and mask in
Fusion format. The location of the <code class="docutils literal notranslate"><span class="pre">.kip</span></code> folder will be vital
information to regenerate a mask with <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> as noted in
<a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">Appendix C</span></a>, or if working with an imagery
dataset that is larger than 65,000 pixels on a side as noted in
<a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix D</span></a>. The version of the imagery
<code class="docutils literal notranslate"><span class="pre">.kip</span></code> folder and mask <code class="docutils literal notranslate"><span class="pre">.kmp</span></code> folders will change over time as
newer source imagery is imported for the image resource or
changes are made to the automask. The <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span></code>
command will report the full paths that relate to the most current
version of the image resource. Further information about the
gequery command may be found in the <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--help</span></code> menu.</p>
<p class="rubric" id="locate-mask-file-built-automask-fusion-build">Example 2: Locate a mask.tif file automatically built
by the automask feature of a Fusion resource build</p>
<p>Finding the mask file automatically computed by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>
during a resource import is slightly different since it is the
output of a different phase of the image resource build, but is
needed to build the <code class="docutils literal notranslate"><span class="pre">.kmp</span></code> folder. The <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span></code>
options can help locate the mask file built by the Fusion automask
tool <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>. Here is an example command to locate the full
path of the mask file computed by Fusion for the SFBayAreaLanSat
image resource built during the Fusion Pro Tutorial:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">gequery</span> <span class="pre">--outfiles</span> <span class="pre">Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/maskgen.kia/ver002/mask.tif</span></code></p>
<p>The response from <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span></code> provides the full path
location to the mask file built by the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> tool when the
automask masking mode is selected for a resource. This computed
mask file is used to build the Fusion-format mask (<code class="docutils literal notranslate"><span class="pre">.kmp</span></code>) for a
resource. It is possible to build complex mask files for image
resources by combining output from the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> automask tool
and the <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> tool, as described in the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5
Example</span></a> where the automatic fill data
detection of <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> can be combined with coastline masking
capabilities of <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>.</p>
<p>Please see the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5 Example</span></a> for further
details.</p>
<p class="rubric" id="locate-mask-file-fusion-format-file-building-mask-product">Example 3: Locate the mask.tif file and Fusion-format
.kip file utilized for building the Fusion format .kmp (mask
product)</p>
<p>Two inputs are required by Fusion to convert a mask file from
<code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code>format into Fusion format for use with an image or
terrain resource: the location of the <code class="docutils literal notranslate"><span class="pre">mask.tif</span></code> file and the
location of the correct <code class="docutils literal notranslate"><span class="pre">.kip</span></code> folder. Examples
<a class="reference internal" href="#locate-fusion-format-imagery-mask-files-image-resource"><span class="std std-ref">1</span></a> and <a class="reference internal" href="#locate-mask-file-built-automask-fusion-build"><span class="std std-ref">2</span></a> demonstrated
how <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span></code> may be utilzed to determine the folder
paths of the Fusion-format <code class="docutils literal notranslate"><span class="pre">.kip</span></code> and <code class="docutils literal notranslate"><span class="pre">.kmp</span></code> data and the
location of the mask file computed by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> during the
resource build.</p>
<p>The locations of the <code class="docutils literal notranslate"><span class="pre">.kip</span></code> and <code class="docutils literal notranslate"><span class="pre">mask.tif</span></code> files read in by
Fusion for generating the Fusion-format <code class="docutils literal notranslate"><span class="pre">.kmp</span></code> mask may be found
with the <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--infiles</span></code> option. This is useful in
situations where a higher-fidelity base mask file is needed for
building a custom mask file, as described in the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5
Example</span></a>. Here is the command to locate the
full paths to the computed mask file (<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>) and
Fusion-format <code class="docutils literal notranslate"><span class="pre">.kip</span></code> folder for the SFBayAreaLanSat image
resource built during the Fusion Pro Tutorial:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/gepolymaskgen$</span> <span class="pre">gequery</span> <span class="pre">--infiles</span> <span class="pre">Resources/Imagery/SFBayAreaLanSat.kiasset/maskproduct.kia</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/gevol-local/gepolymaskgen/Resources/Imagery/SFBayAreaLanSat.kiasset/product.kia/ver001/raster.kip</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">/opt/google/share/tutorials/fusion/Imagery/usgsLanSat-mask.tif</span></code></p>
<p>A new base mask file may be built with the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> command
which permits a larger number of pixels to be used for developing
the mask file - as described in <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix D</span></a>
- which could then be used in conjunction with There <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5
Example</span></a>, or as a base mask for very large
image resources as described in <a class="reference internal" href="#building-custom-masks-large-source-imagery"><span class="std std-ref">Appendix F</span></a>.</p>
<p class="rubric" id="determining-source-file-raster-size-geinfo">Appendix C: Determining source file raster size with
geinfo</p>
<p>Google Earth Enterprise Fusion Pro includes a tool called
<code class="docutils literal notranslate"><span class="pre">geinfo</span></code> capable of reporting metadata about source imagery and
terrain files, including:</p>
<ul class="simple">
<li>Overall raster dimensions</li>
<li>Pixel resolution</li>
<li>Geographic location of the data</li>
<li>Native projection or geographic coordinate system</li>
<li>Number of bands in the file</li>
<li>Band format (ex: 8-bit, 16-bit)</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">geinfo</span></code> is able to read the same raster source formats that can
be imported as Fusion image resources, including <code class="docutils literal notranslate"><span class="pre">khvr</span></code> (virtual
raster) files for the raster dimensions of a mosaic.</p>
<p>Mask files computed with the <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> tool will be
written out in <code class="docutils literal notranslate"><span class="pre">GeoTIFF</span></code> format and must be less than 2 GB in
total file size. The <code class="docutils literal notranslate"><span class="pre">geinfo</span></code> tool can be used to determine the
overall raster size of the input source file by entering
<code class="docutils literal notranslate"><span class="pre">geinfo</span> <span class="pre">source_imagery.tif</span></code> onto the command line, where GEE
Fusion Pro is installed, and then mulitplying the source file
raster width (pixels) and height (pixels) values. The product may
be used to estimate the file size that would be created by
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>, if the source file was specified as the
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span></code>. Example output from <code class="docutils literal notranslate"><span class="pre">geinfo</span></code> is
included below for the California 15-meter Landsat imagery that
was used with the <a class="reference internal" href="#masks-coastline-shared-edges"><span class="std std-ref">Case 3 Example</span></a>. The raster dimensions for the mosaic
are listed near the top for quick reference.</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">geinfo</span> <span class="pre">glandsat_15m_california_bay_area.khvr</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">Type:</span>&#160;&#160; <span class="pre">KHM/Keyhole</span> <span class="pre">Mosaic</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Raster</span> <span class="pre">Size:</span> <span class="pre">35840,30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Extents:</span>&#160;&#160;&#160;&#160; <span class="pre">(ns)</span> <span class="pre">38.496093750000,35.859375000000</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">(ew)</span> <span class="pre">-121.113281250000,-124.189453125000</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Pixel</span> <span class="pre">Size:</span>&#160; <span class="pre">(xy)</span> <span class="pre">0.000085830688,-0.000085830688</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Keyhole</span> <span class="pre">Normalized</span> <span class="pre">{</span></code></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Raster</span> <span class="pre">Size:</span> <span class="pre">35840,30720</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Extents:</span>&#160;&#160;&#160;&#160; <span class="pre">(ns)</span> <span class="pre">38.496093750000,35.859375000000</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">(ew)</span> <span class="pre">-121.113281250000,-124.189453125000</span></code></div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Pixel</span> <span class="pre">Size:</span>&#160; <span class="pre">(xy)</span> <span class="pre">0.000085830688,-0.000085830688</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Top</span> <span class="pre">level:</span>&#160;&#160; <span class="pre">22</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">}</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Spatial</span> <span class="pre">Reference</span> <span class="pre">System:</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">GEOGCS[&quot;WGS</span> <span class="pre">84&quot;,</span></code></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">DATUM[&quot;WGS_1984&quot;,</span></code></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">SPHEROID[&quot;WGS</span> <span class="pre">84&quot;,6378137,298.257223563,</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],</span></code></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PRIMEM[&quot;Greenwich&quot;,0],</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">UNIT[&quot;degree&quot;,0.0174532925199433],</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</span></code></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Corner</span> <span class="pre">Coordinates:</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Upper</span> <span class="pre">Left</span>&#160; <span class="pre">(-124.1894531,</span>&#160; <span class="pre">38.4960938)</span> <span class="pre">(124d11'22.03&quot;W,</span> <span class="pre">38d29'45.94&quot;N)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Lower</span> <span class="pre">Left</span>&#160; <span class="pre">(-124.1894531,</span>&#160; <span class="pre">35.8593750)</span> <span class="pre">(124d11'22.03&quot;W,</span> <span class="pre">35d51'33.75&quot;N)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Upper</span> <span class="pre">Right</span> <span class="pre">(-121.1132812,</span>&#160; <span class="pre">38.4960938)</span> <span class="pre">(121d</span> <span class="pre">6'47.81&quot;W,</span> <span class="pre">38d29'45.94&quot;N)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Lower</span> <span class="pre">Right</span> <span class="pre">(-121.1132812,</span>&#160; <span class="pre">35.8593750)</span> <span class="pre">(121d</span> <span class="pre">6'47.81&quot;W,</span> <span class="pre">35d51'33.75&quot;N)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Center</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">(-122.6513672,</span>&#160; <span class="pre">37.1777344)</span> <span class="pre">(122d39'4.92&quot;W,</span> <span class="pre">37d10'39.84&quot;N)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Band</span> <span class="pre">1</span> <span class="pre">Block=2048x200</span> <span class="pre">Type=Byte,</span> <span class="pre">ColorInterp=Red</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">NoData</span> <span class="pre">Value=0</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Band</span> <span class="pre">2</span> <span class="pre">Block=2048x200</span> <span class="pre">Type=Byte,</span> <span class="pre">ColorInterp=Green</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">NoData</span> <span class="pre">Value=0</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Band</span> <span class="pre">3</span> <span class="pre">Block=2048x200</span> <span class="pre">Type=Byte,</span> <span class="pre">ColorInterp=Blue</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">NoData</span> <span class="pre">Value=0</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Band</span> <span class="pre">4</span> <span class="pre">Block=2048x200</span> <span class="pre">Type=Byte,</span> <span class="pre">ColorInterp=Alpha</span></code></p>
<p>Multiplying the raster dimensions together (<code class="docutils literal notranslate"><span class="pre">35840</span> <span class="pre">x</span> <span class="pre">30720</span></code>)
results in 1,101,004,800 which means a 1 GB (approximate) mask file
would be created if the <code class="docutils literal notranslate"><span class="pre">khvr</span></code> was specified as a
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span> <span class="pre">--base_image</span></code>.</p>
<p class="rubric" id="maximum-suggested-raster-dimensions-source-files-gepolymaskgen">Maximum suggested raster dimensions for source files
used as gepolymaskgen –base_image files</p>
<p>Some suggested maximum raster dimensions are included as a rough
guideline to help size and scope source files when creating custom
masks. The source file should not be used as a base image for
<code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> if the total raster size is larger than
2,000,000,000 pixels. For this case, a lower-resolution image
should be created as described in <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix
D</span></a>.</p>
<p class="rubric" id="square-shaped-rasters">Square-shaped rasters</p>
<p>Perfectly square source raster files should be less than 44,000
pixels by 44,000 pixels for use as a base image or base mask
with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>. A substitute base image or mask file
should be created for square-shaped source images that are larger
than 44,000 pixels on both sides, as described in <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix
D</span></a>.</p>
<p class="rubric" id="rectangular-sharped-rasters">Rectangular-shaped rasters</p>
<p>The maximum suggested raster dimensions for rectangular images
varies by the amount of the longest side. Some suggested
dimensions are included below for reference.</p>
<ul class="simple">
<li>55,000 x 30,000</li>
<li>60,000 x 35,000</li>
<li>65,000 x 30,000</li>
<li>70,000 x 27,000</li>
</ul>
<p>A substitute base image or mask file should be created if the
source imagery is larger than these recommended dimensions, or if
the product of the raster width and height is more than
2,000,000,000 pixels. Instructions for creating a substitute base
image, with <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>, may be found in <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix
D</span></a>.</p>
<p class="rubric" id="building-high-resolution-mask-files-gemaskgen">Appendix D: Building high resolution mask files with
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> automask utility has several options to
automatically compute a mask file from an imported Fusion imagery
resource (<code class="docutils literal notranslate"><span class="pre">.kip</span></code>); however, by default <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> limits the
computed mask to be a maximum of 16,000 pixels on any one
side, which can result in low-resolution masks for high-resolution
image resources. Higher resolution masks may be created by
manually invoking the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> tool and specifying a higher pixel
value for the <code class="docutils literal notranslate"><span class="pre">--maxsize</span></code> option.</p>
<p><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> requires access to the Fusion format version of the
imagery resource to compute the mask file, which may be located
either in the Fusion Asset Root or in a separate folder, depending
on whether the imagery was processed by another system and copied to the
Fusion system for use, or if a <code class="docutils literal notranslate"><span class="pre">KRP.taskrule</span></code> taskrule file
redirects output from Fusion resource imports to another volume.
The location of both the <code class="docutils literal notranslate"><span class="pre">.kip</span></code> folder Fusion-format imagery and
<code class="docutils literal notranslate"><span class="pre">mask.tif</span></code> file may be found with the <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--infiles</span></code>
command as described in <a class="reference internal" href="#locating-mask-files-format-data-asset-root"><span class="std std-ref">Appendix B</span></a>,
<a class="reference internal" href="#locate-mask-file-fusion-format-file-building-mask-product"><span class="std std-ref">Example 3</span></a>.</p>
<p>The exact settings used by <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> when building a mask file
for an image resource may be found from the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> log
file, available in the Google Earth Enterprise Fusion Pro Asset
Manager. To access the log file, load the Asset Manager and
right-click on the desired image resource. Select  <strong>Current
Version Properties</strong>,  then expand the <code class="docutils literal notranslate"><span class="pre">CHILD.KRMP</span></code> item
until the <code class="docutils literal notranslate"><span class="pre">Maskgen.kia&amp;</span></code> entry is visible.</p>
<p><img alt="maskgen version properties" src="../../images/image44.jpg" /></p>
<p>Click the logfile icon to the right of the
<code class="docutils literal notranslate"><span class="pre">Maskgen.kia</span></code> entry to open the logfile.</p>
<p><img alt="Maskgen Logfile diagram" src="../../images/image26.jpg" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> command executed by Fusion Pro during the image
resource build is visible at the top of the log file on the line
starting with <code class="docutils literal notranslate"><span class="pre">COMMAND</span></code>. This command may be utilized as a
template for building a higher resolution mask by also including
the <code class="docutils literal notranslate"><span class="pre">--maxsize</span></code> option.</p>
<p>An example <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> use will be included below that will
build a mask for the <code class="docutils literal notranslate"><span class="pre">example-imagery.kip</span></code> image resource with a
maximum size of 55,000 pixels, feathered 100 pixels into the
imagery, with fill data set to pixel value 0:</p>
<p><code class="docutils literal notranslate"><span class="pre">jcain&#64;machine123:/gevol-local/src/gepolymaskgen-howto$</span> <span class="pre">time</span> <span class="pre">gemaskgen</span> <span class="pre">--mask</span> <span class="pre">--maxsize</span> <span class="pre">55000</span> <span class="pre">--feather</span> <span class="pre">100</span> <span class="pre">/path/to/example-imagery.kip</span> <span class="pre">/path/to/example-imagery-mask.tif</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>will read the <code class="docutils literal notranslate"><span class="pre">example-imagery.kip</span></code> folder and
compute a mask file that masks Fill Data pixels and builds a
feathered edge of 100 pixels into the usable imagery. The actual
output dimensions of the computed mask varies from case to case;
however, <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> will restrict the maximum length of either
the height or width to 55,000 pixels. Additional information about
recommended mask dimensions may be found in <a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">Appendix
C</span></a>. Once complete, the mask file computed by
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> may be used as a base image for building a custom
mask with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> and then imported with the image
resource as described in <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a>.</p>
<p>Further information about available <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> options may be
found in the <code class="docutils literal notranslate"><span class="pre">gemaskgen</span> <span class="pre">--help</span></code> menu.</p>
<p class="rubric" id="using-photo-editing-app-augment-custom-app">Appendix E: Using a Photo Editing application to
augment a custom mask</p>
<p>This is a special section for manually modifying a custom mask for
an imagery resource. Both the <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> and <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code>
tools are able to build high-quality masks to accompany image
resources; however, there are cases where neither tool may be able
to provide the correct solution for a set of imagery. Consider the
mask and imagery resource from the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5
Example</span></a> based on the SFBayAreaLanSat image
resource for California (below) where <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> successfully
masked Fill Data from view and <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> successfully
masked ocean imagery to the specified coastline. The resulting
mask masks out the San Francisco Bay which makes the
low-resolution BlueMarble imagery visible (green).</p>
<p class="rubric">SFBayAreaLanSat image resource as completed in Example
Case 5:</p>
<p><img alt="SFBayAreaLanSat image with custom mask" src="../../images/image12.jpg" /></p>
<p class="rubric">SFBayAreaLanSat image resource with automasking only:</p>
<p><img alt="SFBayAreaLanSat image with automask" src="../../images/image27.jpg" /></p>
<p>One solution for this case is to manually modify the finished
custom mask with a photo editing tool such as GIMP or Adobe
Photoshop to alter the mask to show more or less imagery
based on the circumstance. In this example, the
<code class="docutils literal notranslate"><span class="pre">usgsLanSat-mask.tif</span></code> custom mask will be modified such that
imagery for the San Francisco Bay will be visible in the final
image resource while still masking imagery to the California
Coastline. Here is the workflow for manually modifying the mask
file for the SFBayAreaLanSat image resource:</p>
<ol class="arabic">
<li><p class="first">Load the <code class="docutils literal notranslate"><span class="pre">usgsLanSat-mask.tif</span></code> mask file created from the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5
Example</span></a> into the photo editing
application.</p>
<p><img alt="merged custom mask" src="../../images/image01.jpg" /></p>
</li>
<li><p class="first">Select the paintbrush tool and set to paint with white
fill(255). The pixel width, opacity, and feather value of the
brush needed will vary for each mask.</p>
</li>
<li><p class="first">Brush out the entire San Francisco Bay to remove the bay
coastline mask.</p>
<p><img alt="bay coastline mark removed" src="../../images/image04.jpg" /></p>
</li>
<li><p class="first">Save the updated mask file to the same folder location as the
<code class="docutils literal notranslate"><span class="pre">usgsLanSat.tif</span></code> source image file for the SFBayAreaLanSat
image
resource<code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">/opt/google/share/tutorials/fusion/Imagery</span></code>.</p>
</li>
<li><p class="first">Modify the SFBayAreaLanSat image resource to enable the
<code class="docutils literal notranslate"><span class="pre">HaveMask</span></code> mask mode.</p>
<p>Please see <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a>, Examples <a class="reference internal" href="#enable-havemask-existing-image-resource"><span class="std std-ref">3</span></a> and <a class="reference internal" href="#enable-havemask-command-line-existing-image-resource"><span class="std std-ref">4</span></a> for
further details.</p>
</li>
<li><p class="first">Build the image resource to import the updated mask file.</p>
</li>
<li><p class="first">Load the SFBayAreaLanSat image resource into the Fusion Pro
Preview.</p>
<p class="rubric">usgsLanSat mask after mask updates to show the
imagery for the San Francisco Bay:</p>
<p><img alt="san francisco bay with usgsLanSat mask" src="../../images/image12.jpg" /></p>
</li>
</ol>
<p class="rubric">usgsLanSat mask before mask edits:</p>
<p><img alt="usgsLanSat before mask" src="../../images/image27.jpg" /></p>
<p class="rubric" id="building-custom-masks-large-source-imagery">Appendix F: Building custom masks for large source
imagery</p>
<p>This is a special section intended for use when working with
source imagery datasets - such as an image resource of 0.5-meter
per pixel resolution 3-band, color imagery for an entire state -
where a high-fidelity mask could easily create a mask
file larger than 2 GB in file size. The same tools described in this
document and appendices can be used to construct a custom mask
that provides high fidelity masking for the image resource while
being less than 2GB in file size. The key difference in the
workflow for building custom masks for large imagery resources -
where the image resource will have more than 65,000 pixels on one
side - is the source imagery are imported first, then
<code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> is called manually to create a stand-in base mask
file for use with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code>. This workflow is similar to
the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5 Example</span></a> where the image resource
was imported first into Fusion Pro and then a custom mask was
generated and added after import.</p>
<p>The general workflow for this use case will be:</p>
<p>Assuming the source imagery is detected to be larger than 65,000
pixels on one side or more than 2,000,000,000 total pixels with
<code class="docutils literal notranslate"><span class="pre">geinfo</span></code> (See <a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">Appendix C</span></a>);</p>
<ol class="arabic simple">
<li>Import the image resource with Fusion Pro.</li>
<li>View the finished image resource in the Fusion Pro window to
determine what type of masking may be needed so an appropriate
example case may be referenced.</li>
<li>Find the full paths to the imported Fusion-format <code class="docutils literal notranslate"><span class="pre">kip</span></code>
folder for the imagery with the <code class="docutils literal notranslate"><span class="pre">gequery</span> <span class="pre">--outfiles</span> <span class="pre">command</span></code>
(See <a class="reference internal" href="#locating-mask-files-format-data-asset-root"><span class="std std-ref">Appendix B</span></a>, <a class="reference internal" href="#locate-fusion-format-imagery-mask-files-image-resource"><span class="std std-ref">Example
1</span></a>).</li>
<li>Generate a stand-in base mask file with <code class="docutils literal notranslate"><span class="pre">gemaskgen</span></code> that
will construct an image less than 2,000,000,000 total pixels
(See <a class="reference internal" href="#building-high-resolution-mask-files-gemaskgen"><span class="std std-ref">Appendix D</span></a> for creating the mask
and <a class="reference internal" href="#determining-source-file-raster-size-geinfo"><span class="std std-ref">Appendix C</span></a> for recommended mask
sizes).</li>
<li>Construct a custom mask with <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> referencing the
<strong>stand-in</strong> image from the <a class="reference internal" href="#custom-masks-gemaskgen-gepolymaskgen"><span class="std std-ref">Case 5 Example</span></a>
as the <code class="docutils literal notranslate"><span class="pre">--base_image</span></code>. Reference one of the five example
cases for additional steps in constructing the custom mask.</li>
<li>Update the image resource configuration to enable <code class="docutils literal notranslate"><span class="pre">havemask</span></code>
mode so the custom mask will be imported and applied to the
image resource (See <a class="reference internal" href="#importing-custom-masks-imagery-terrain-gee-fusion"><span class="std std-ref">Appendix A</span></a>, Examples
<a class="reference internal" href="#enable-havemask-existing-image-resource"><span class="std std-ref">3</span></a> and <a class="reference internal" href="#enable-havemask-command-line-existing-image-resource"><span class="std std-ref">4</span></a>).</li>
<li>Build the image resource to commit the change and import the
new custom mask, then view the image resource in the Fusion
Preview window.</li>
</ol>
<p class="rubric" id="gepolymaskgen-help-menu">Appendix G: gepolymaskgen help menu</p>
<p>A full copy of the help contents for <code class="docutils literal notranslate"><span class="pre">gepolymaskgen</span></code> is
available in this appendix for reference:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>usage: gepolymaskgen --help | -?

         gepolymaskgen [--feather &lt;int_feather&gt;] --base_mask &lt;geotiff_mask_file&gt; [options] --output_mask &lt;geotiff_mask_file&gt;

         gepolymaskgen [--feather &lt;int_feather&gt;] --base_image &lt;geotiff_image_file&gt; [options] --output_mask &lt;geotiff_mask_file&gt;

Options are applied in order given.

Valid options:

         --feather &lt;int_feather&gt;:          Feather to apply to all

                                          subsequent masks until a

                                          different feather is given.

                                          Feather can be 0, positive,

                                          or negative. Default is 0.

         --feather_border &lt;int_flag&gt;:     If flag is non-zero, border

                                          is feathered. Otherwise,

                                          border is left in tact.

                                          Flag remains in effect

                                          until it is modified.

                                          Default is border is

                                          feathered.

         --and_neg_mask &lt;mask_file&gt;:      Bitwise AND of negative image

                                          of polygon or raster mask

                                          with the current mask.

                                          Polygons can be given in

                                          .kml or .shp files and are

                                          assumed to be filled with

                                          0x00. Raster masks should be

                                          .tif files with the same pixel

                                          dimensions as the base mask.

                                          Care should be taken not to

                                          overlap feathered regions.

         --or_mask &lt;mask_file&gt;:           Bitwise OR polygon or raster

                                          mask to the current mask.

                                          Polygons can be given in

                                          .kml or .shp files and are

                                          assumed to be filled with

                                          0xff. Raster masks should be

                                          .tif files with the same pixel

                                          dimensions as the base mask.

                                          Care should be taken not to

                                          overlap feathered regions.

         --threshold &lt;thresh_byte&gt;:       All pixels at or below the

                                          threshold byte are set to

                                          0x00; all other pixels are set

                                          to 0xff.

Please note that ordering of arguments is important; they are applied in the order that they are given. The feather argument implies that you are setting the feather to be used for any subsequent masks. E.g. to feather the base mask, you must set the feather before the base mask is given. Positive feathers erode the mask (white area retracts); negative feathers expand the mask (white area grows).

   Examples:

   -- simple polygon mask with no feathering

      gepolymaskgen   --base_image /path/input_image.tif \

                        --or_mask /path/polygon.kml \

                        --output_mask /path/result_mask.tif

      -- negative polygon mask with some feathering

      gepolymaskgen   --base_image /path/input_image.tif \

                        --feather 30 \

                        --feather_border 0 \

                        --and_neg_mask /path/polygon.kml \

                        --invert \

                        --output_mask /path/result_mask.tif

                        -- OR and AND polygon and tiff masks with different feathers \

                        gepolymaskgen --feather 30 \

                        --base_mask /path/base_mask.tif \

                        --feather 20 \

                        --feather_border 0 \

                        --or_mask /path/SF.kml \

                        --or_mask /path/daly_city.kml \

                        --feather 15 \

                        --feather_border 1 \

                        --or_mask /path/circle_mask.tif \

                        --feather 5 \

                        --and_neg_mask /path/gg_park.kml \

                        --and_neg_mask /path/northbeach.kml \

                        --feather 40 \

                        --and_neg_mask /path/circle_mask2.tif \

                        --output_mask /path/mask.tif
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="manageMosaicsWithVirtualRasters.html" title="Manage mosaics with virtual rasters"
             >next</a> |</li>
        <li class="right" >
          <a href="googleMapsRasterBg.html" title="Google Maps raster background"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Google Earth Enterprise 5.3.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../fusionResAndProj.html" >Fusion Resources and Projects</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Open GEE Contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>